# è¯¾ç¨‹è¡¨åº”ç”¨å¼€å‘è®°å½•

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„è¯¾ç¨‹è¡¨åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨ Rust æ„å»ºåç«¯ï¼ŒTauri + Vue3 + Element Plus æ„å»ºå‰ç«¯ã€‚

### æŠ€æœ¯æ ˆ
- **åç«¯**: Rust + Actix-web + Serde + Chrono
- **å‰ç«¯**: Tauri + Vue3 + TypeScript + Vite + Element Plus
- **æ¶æ„**: Cargo Workspace ç®¡ç†å¤šé¡¹ç›®

## è¯¦ç»†å¼€å‘æ­¥éª¤

### 1. é¡¹ç›®ç»“æ„é‡æ„

#### 1.1 åˆ›å»º Cargo Workspace
```toml
# Cargo.toml
[workspace]
members = [
    "backend"
]
exclude = [
    "frontend/src-tauri"
]
resolver = "2"
```

#### 1.2 é¡¹ç›®ç›®å½•ç»“æ„
```
class_schudle/
â”œâ”€â”€ Cargo.toml (workspaceé…ç½®)
â”œâ”€â”€ backend/ (Ruståç«¯)
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ main.rs
â”‚       â”œâ”€â”€ models.rs
â”‚       â”œâ”€â”€ handlers.rs
â”‚       â””â”€â”€ storage.rs
â””â”€â”€ frontend/ (Tauriå‰ç«¯)
    â”œâ”€â”€ package.json
    â”œâ”€â”€ .yarnrc.yml
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ main.ts
    â”‚   â”œâ”€â”€ App.vue
    â”‚   â”œâ”€â”€ components/
    â”‚   â”‚   â”œâ”€â”€ ScheduleDisplay.vue
    â”‚   â”‚   â””â”€â”€ SettingsPanel.vue
    â”‚   â”œâ”€â”€ stores/
    â”‚   â”‚   â””â”€â”€ scheduleStore.ts
    â”‚   â””â”€â”€ services/
    â”‚       â””â”€â”€ apiService.ts
    â””â”€â”€ src-tauri/ (Taurié…ç½®)
```

### 2. åç«¯å¼€å‘ (Actix-web)

#### 2.1 ä¾èµ–é…ç½®
```toml
# backend/Cargo.toml
[dependencies]
actix-web = "4.4"
actix-cors = "0.7"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
tokio = { version = "1.0", features = ["full"] }
uuid = { version = "1.0", features = ["v4", "serde"] }
chrono = { version = "0.4", features = ["serde"] }
anyhow = "1.0"
env_logger = "0.10"
```

#### 2.2 æ•°æ®æ¨¡å‹è®¾è®¡
```rust
// backend/src/models.rs
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Course {
    pub id: Uuid,
    pub name: String,
    pub teacher: Option<String>,
    pub location: Option<String>,
    pub weekday: u8, // 1=Monday, 2=Tuesday, ..., 7=Sunday
    pub start_time: NaiveTime,
    pub end_time: NaiveTime,
    pub weeks: Vec<u8>, // ç¬¬å‡ å‘¨
    pub color: Option<String>,
}
```

#### 2.3 API æ¥å£è®¾è®¡
- `GET /api/v1/schedule` - è·å–è¯¾ç¨‹è¡¨
- `POST /api/v1/courses` - åˆ›å»ºè¯¾ç¨‹
- `PUT /api/v1/courses/{id}` - æ›´æ–°è¯¾ç¨‹
- `DELETE /api/v1/courses/{id}` - åˆ é™¤è¯¾ç¨‹
- `POST /api/v1/schedule/push` - ç¬¬ä¸‰æ–¹æ¨é€è¯¾è¡¨æ¥å£

#### 2.4 å­˜å‚¨å±‚å®ç°
ä½¿ç”¨å†…å­˜å­˜å‚¨ (HashMap) ä½œä¸ºç®€å•å®ç°ï¼Œæ”¯æŒæ‰©å±•ä¸ºæ•°æ®åº“å­˜å‚¨ã€‚

### 3. å‰ç«¯å¼€å‘ (Tauri + Vue3)

#### 3.1 Tauri é¡¹ç›®åˆå§‹åŒ–
```bash
cd frontend
npm create tauri-app@latest . --template vue-ts
```

#### 3.2 Yarn é…ç½®ä¼˜åŒ–
```yaml
# frontend/.yarnrc.yml
nodeLinker: node-modules
```

#### 3.3 Element Plus é›†æˆ
```bash
yarn add element-plus @element-plus/icons-vue
```

```typescript
// frontend/src/main.ts
import ElementPlus from 'element-plus';
import 'element-plus/dist/index.css';
import * as ElementPlusIconsVue from '@element-plus/icons-vue';

const app = createApp(App);
app.use(ElementPlus);

// æ³¨å†Œæ‰€æœ‰å›¾æ ‡
for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
  app.component(key, component);
}
```

### 4. æ ¸å¿ƒåŠŸèƒ½å®ç°

#### 4.1 è¯¾ç¨‹è¡¨å±•ç¤ºç»„ä»¶
- **æ—¶é—´è½´è®¾è®¡**: ä½¿ç”¨ Element Plus Timeline ç»„ä»¶
- **å®æ—¶çŠ¶æ€**: å½“å‰è¯¾ç¨‹é«˜äº®ï¼Œå·²è¿‡è¯¾ç¨‹ç°æ˜¾
- **åŠ¨ç”»æ•ˆæœ**: å½“å‰è¯¾ç¨‹è„‰å†²åŠ¨ç”»
- **ç©ºçŠ¶æ€å¤„ç†**: å‹å¥½çš„ç©ºçŠ¶æ€é¡µé¢

#### 4.2 è®¾ç½®ç®¡ç†ç»„ä»¶
- **åç«¯è¿æ¥**: å¯é…ç½®åç«¯æœåŠ¡åœ°å€
- **è¯¾ç¨‹ç®¡ç†**: è¡¨æ ¼å½¢å¼å±•ç¤ºï¼Œæ”¯æŒå¢åˆ æ”¹
- **è¡¨å•éªŒè¯**: Element Plus è¡¨å•éªŒè¯
- **ç”¨æˆ·åé¦ˆ**: æ¶ˆæ¯æç¤ºå’Œç¡®è®¤å¯¹è¯æ¡†

#### 4.3 çŠ¶æ€ç®¡ç†
```typescript
// frontend/src/stores/scheduleStore.ts
class ScheduleStore {
  // æœ¬åœ°å­˜å‚¨ + åç«¯åŒæ­¥
  // æ”¯æŒç¦»çº¿æ¨¡å¼
  // è‡ªåŠ¨ä¿å­˜åˆ° localStorage
}
```

#### 4.4 API æœåŠ¡å±‚
```typescript
// frontend/src/services/apiService.ts
class ApiService {
  // RESTful API å°è£…
  // é”™è¯¯å¤„ç†
  // ç±»å‹å®‰å…¨
}
```

### 5. UI/UX è®¾è®¡

#### 5.1 è®¾è®¡ç‰¹è‰²
- **æ¸å˜èƒŒæ™¯**: ç´«è‰²æ¸å˜ + æ¯›ç»ç’ƒæ•ˆæœ
- **ç°ä»£åŒ–å¯¼èˆª**: Radio Button åˆ‡æ¢
- **å“åº”å¼å¸ƒå±€**: Element Plus Container ç³»ç»Ÿ
- **åŠ¨ç”»è¿‡æ¸¡**: å¹³æ»‘çš„ç•Œé¢åˆ‡æ¢

#### 5.2 ç»„ä»¶ç‰¹æ€§
- **è¯¾ç¨‹å¡ç‰‡**: å¸¦é¢œè‰²æ ‡è¯†çš„è¯¾ç¨‹ä¿¡æ¯å¡ç‰‡
- **æ—¶é—´è½´**: ç›´è§‚çš„æ—¶é—´çº¿å±•ç¤º
- **è¡¨æ ¼ç®¡ç†**: åŠŸèƒ½å®Œæ•´çš„æ•°æ®è¡¨æ ¼
- **è¡¨å•å¯¹è¯æ¡†**: ç°ä»£åŒ–çš„ç¼–è¾‘ç•Œé¢

### 6. å¼€å‘è¿‡ç¨‹ä¸­çš„é—®é¢˜è§£å†³

#### 6.1 Yarn PnP é—®é¢˜
```yaml
# è§£å†³æ–¹æ¡ˆï¼šç¦ç”¨ PnP æ¨¡å¼
nodeLinker: node-modules
```

#### 6.2 Weekday åºåˆ—åŒ–é—®é¢˜
```rust
// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ u8 æ›¿ä»£ chrono::Weekday
pub weekday: u8, // 1=Monday, 2=Tuesday, ..., 7=Sunday
```

#### 6.3 Cargo Workspace é…ç½®
```toml
# è§£å†³æ–¹æ¡ˆï¼šæ’é™¤ Tauri é¡¹ç›®
exclude = [
    "frontend/src-tauri"
]
```

### 7. æµ‹è¯•éªŒè¯

#### 7.1 åç«¯ API æµ‹è¯•
```bash
# æµ‹è¯•è·å–è¯¾ç¨‹è¡¨
curl -X GET http://localhost:8080/api/v1/schedule

# æµ‹è¯•åˆ›å»ºè¯¾ç¨‹
curl -X POST http://localhost:8080/api/v1/courses \
  -H "Content-Type: application/json" \
  -d '{"name":"Math","teacher":"Teacher Zhang","location":"Room 101","weekday":1,"start_time":"08:00:00","end_time":"09:40:00","weeks":[1,2,3,4,5],"color":"#3498db"}'
```

#### 7.2 å‰ç«¯ç¼–è¯‘æµ‹è¯•
```bash
cd frontend
yarn build  # ç¼–è¯‘æˆåŠŸ
yarn tauri dev  # å¼€å‘æ¨¡å¼å¯åŠ¨æˆåŠŸ
```

### 8. é¡¹ç›®ç‰¹è‰²åŠŸèƒ½

#### 8.1 åŠé€æ˜æ¡Œé¢æ˜¾ç¤º
- è¯¾ç¨‹è¡¨ç»„ä»¶æ”¯æŒåŠé€æ˜æ˜¾ç¤º
- é€‚åˆæ¡Œé¢å¸¸é©»æ˜¾ç¤º

#### 8.2 æ™ºèƒ½è¯¾ç¨‹çŠ¶æ€
- è‡ªåŠ¨è¯†åˆ«å½“å‰è¯¾ç¨‹
- åŒºåˆ†å·²è¿‡ã€è¿›è¡Œä¸­ã€æœªå¼€å§‹çŠ¶æ€

#### 8.3 æœ¬åœ°å­˜å‚¨å¤‡ä»½
- æ”¯æŒç¦»çº¿ä½¿ç”¨
- è‡ªåŠ¨åŒæ­¥åˆ°åç«¯

#### 8.4 ç¬¬ä¸‰æ–¹é›†æˆæ¥å£
- é¢„ç•™ç¬¬ä¸‰æ–¹æ¨é€æ¥å£
- æ”¯æŒæ‰¹é‡å¯¼å…¥è¯¾ç¨‹

### 9. éƒ¨ç½²è¯´æ˜

#### 9.1 åç«¯å¯åŠ¨
```bash
cargo run -p class-schedule-backend
# æœåŠ¡è¿è¡Œåœ¨ http://localhost:8080
```

#### 9.2 å‰ç«¯å¯åŠ¨
```bash
cd frontend
yarn tauri dev
# Tauri åº”ç”¨è‡ªåŠ¨å¯åŠ¨
```

### 10. æ¡Œé¢å°ç»„ä»¶å®ç°

#### 10.1 è®¾è®¡éœ€æ±‚
ç”¨æˆ·è¦æ±‚å®ç°ä¸€ä¸ªæ¡Œé¢è¯¾ç¨‹è¡¨å°ç»„ä»¶ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š
- åŠé€æ˜èƒŒæ™¯ï¼Œé€‚åˆæ¡Œé¢å¸¸é©»æ˜¾ç¤º
- å·¦è¾¹æ˜¾ç¤ºæ—¶é—´ï¼Œå³è¾¹æ˜¾ç¤ºè¯¾ç¨‹ä¿¡æ¯
- å‚ç›´æ’åˆ—çš„åˆ—è¡¨å¸ƒå±€
- ç´§å‡‘çš„è®¾è®¡ï¼Œé€‚åˆå°çª—å£æ˜¾ç¤º

#### 10.2 å®ç°æ–¹æ¡ˆ

**1. é‡æ„ç°æœ‰ç»„ä»¶**
- æ›´æ–° `ScheduleDisplay.vue` ä¸ºæ¡Œé¢å°ç»„ä»¶æ ·å¼
- é‡‡ç”¨æ›´ç´§å‡‘çš„å¸ƒå±€è®¾è®¡
- å¢å¼ºåŠé€æ˜æ•ˆæœå’Œæ¯›ç»ç’ƒèƒŒæ™¯

**2. åˆ›å»ºç‹¬ç«‹å°ç»„ä»¶**
```vue
// frontend/src/components/DesktopScheduleWidget.vue
- ä¸“é—¨çš„æ¡Œé¢å°ç»„ä»¶ç‰ˆæœ¬
- æ›´å°çš„å°ºå¯¸ (350px å®½åº¦)
- æ›´å¼ºçš„é€æ˜æ•ˆæœ (75% é€æ˜åº¦)
- ä¼˜åŒ–çš„å­—ä½“å¤§å°å’Œé—´è·
```

**3. å¤šå…¥å£é…ç½®**
```html
<!-- frontend/widget.html -->
ç‹¬ç«‹çš„å°ç»„ä»¶å…¥å£é¡µé¢
```

```typescript
// frontend/src/widget.ts
ç‹¬ç«‹çš„å°ç»„ä»¶å¯åŠ¨æ–‡ä»¶
```

```typescript
// frontend/vite.config.ts
é…ç½®å¤šå…¥å£æ„å»ºï¼š
- main: ä¸»åº”ç”¨ (index.html)
- widget: æ¡Œé¢å°ç»„ä»¶ (widget.html)
```

#### 10.3 æ ·å¼ç‰¹æ€§

**1. åŠé€æ˜è®¾è®¡**
```css
background: rgba(255, 255, 255, 0.75);
backdrop-filter: blur(20px);
```

**2. æ—¶é—´-è¯¾ç¨‹å¸ƒå±€**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»Šæ—¥è¯¾ç¨‹        14:30      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 08:00  â”‚ é«˜ç­‰æ•°å­¦           â”‚
â”‚   -    â”‚ å¼ æ•™æˆ             â”‚
â”‚ 09:40  â”‚ ğŸ“ æ•™å­¦æ¥¼A101      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 10:00  â”‚ è‹±è¯­å¬åŠ›           â”‚
â”‚   -    â”‚ æè€å¸ˆ             â”‚
â”‚ 11:40  â”‚ ğŸ“ è¯­éŸ³å®¤B203      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**3. çŠ¶æ€æŒ‡ç¤º**
- ç»¿è‰²ï¼šæ­£åœ¨è¿›è¡Œçš„è¯¾ç¨‹ (å¸¦è„‰å†²åŠ¨ç”»)
- æ©™è‰²ï¼šå³å°†å¼€å§‹çš„è¯¾ç¨‹ (30åˆ†é’Ÿå†…)
- ç°è‰²ï¼šå·²ç»“æŸçš„è¯¾ç¨‹
- è“è‰²ï¼šæœªæ¥çš„è¯¾ç¨‹

#### 10.4 ä½¿ç”¨æ–¹å¼

**å¼€å‘æ¨¡å¼**
```bash
# ä¸»åº”ç”¨
npm run dev
# è®¿é—® http://localhost:1420/

# æ¡Œé¢å°ç»„ä»¶
# è®¿é—® http://localhost:1420/widget.html
```

**ç”Ÿäº§æ„å»º**
```bash
npm run build
# ç”Ÿæˆä¸¤ä¸ªå…¥å£ï¼š
# - dist/index.html (ä¸»åº”ç”¨)
# - dist/widget.html (æ¡Œé¢å°ç»„ä»¶)
```

### 11. æ‰©å±•å»ºè®®

- [ ] æ·»åŠ æ•°æ®åº“æŒä¹…åŒ–å­˜å‚¨
- [ ] å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [ ] æ·»åŠ è¯¾ç¨‹æé†’åŠŸèƒ½
- [ ] æ”¯æŒå¯¼å…¥/å¯¼å‡ºè¯¾è¡¨
- [ ] æ·»åŠ æ›´å¤šä¸»é¢˜å’Œè‡ªå®šä¹‰é€‰é¡¹
- [ ] ç§»åŠ¨ç«¯é€‚é…
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [x] æ¡Œé¢å°ç»„ä»¶å®ç°

## æ€»ç»“

æœ¬é¡¹ç›®æˆåŠŸå®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç•Œé¢ç¾è§‚çš„è¯¾ç¨‹è¡¨åº”ç”¨ï¼Œå±•ç¤ºäº†ç°ä»£åŒ–çš„å‰åç«¯åˆ†ç¦»æ¶æ„è®¾è®¡ã€‚ä½¿ç”¨äº† Rust çš„é«˜æ€§èƒ½åç«¯å’Œ Vue3 + Element Plus çš„ç°ä»£åŒ–å‰ç«¯ï¼Œæä¾›äº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå¼€å‘ä½“éªŒã€‚

æœ€æ–°æ·»åŠ çš„æ¡Œé¢å°ç»„ä»¶åŠŸèƒ½æä¾›äº†ä¸€ä¸ªåŠé€æ˜ã€ç´§å‡‘çš„è¯¾ç¨‹è¡¨æ˜¾ç¤ºæ–¹æ¡ˆï¼Œé€‚åˆä½œä¸ºæ¡Œé¢å¸¸é©»å·¥å…·ä½¿ç”¨ï¼Œå…·æœ‰è‰¯å¥½çš„è§†è§‰æ•ˆæœå’Œå®ç”¨æ€§ã€‚

### 12. Tauri æ¡Œé¢å°ç»„ä»¶é›†æˆ

#### 12.1 Tauri çª—å£é…ç½®
æ›´æ–° `tauri.conf.json` é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä¸“é—¨çš„å°ç»„ä»¶çª—å£ï¼š

```json
{
  "app": {
    "windows": [
      {
        "label": "main",
        "title": "è¯¾ç¨‹è¡¨ç®¡ç†ç³»ç»Ÿ",
        "width": 1000,
        "height": 700,
        "resizable": true,
        "center": true
      },
      {
        "label": "widget",
        "title": "è¯¾ç¨‹è¡¨å°ç»„ä»¶",
        "url": "widget.html",
        "width": 380,
        "height": 500,
        "resizable": true,
        "alwaysOnTop": true,
        "decorations": false,
        "transparent": true,
        "skipTaskbar": true,
        "visible": false
      }
    ]
  }
}
```

#### 12.2 Rust åç«¯çª—å£ç®¡ç†
åœ¨ `src-tauri/src/lib.rs` ä¸­æ·»åŠ çª—å£æ§åˆ¶å‘½ä»¤ï¼š

```rust
// æ˜¾ç¤ºæ¡Œé¢å°ç»„ä»¶
#[tauri::command]
fn show_widget(app: tauri::AppHandle) -> Result<(), String>

// éšè—æ¡Œé¢å°ç»„ä»¶
#[tauri::command]
fn hide_widget(app: tauri::AppHandle) -> Result<(), String>

// åˆ‡æ¢æ¡Œé¢å°ç»„ä»¶æ˜¾ç¤ºçŠ¶æ€
#[tauri::command]
fn toggle_widget(app: tauri::AppHandle) -> Result<bool, String>
```

#### 12.3 å‰ç«¯é›†æˆ
åœ¨ä¸»åº”ç”¨ä¸­æ·»åŠ æ§åˆ¶æŒ‰é’®ï¼š

```vue
<el-button
  type="primary"
  size="large"
  @click="toggleWidget"
  :icon="widgetVisible ? 'Hide' : 'View'"
>
  {{ widgetVisible ? 'éšè—' : 'æ˜¾ç¤º' }}æ¡Œé¢å°ç»„ä»¶
</el-button>
```

#### 12.4 Windows æ¡Œé¢å°ç»„ä»¶ç‰¹æ€§
- **æ— è¾¹æ¡†çª—å£**ï¼š`decorations: false` å®ç°æ— æ ‡é¢˜æ 
- **é€æ˜èƒŒæ™¯**ï¼š`transparent: true` æ”¯æŒé€æ˜æ•ˆæœ
- **ç½®é¡¶æ˜¾ç¤º**ï¼š`alwaysOnTop: true` å§‹ç»ˆåœ¨æœ€å‰
- **æ‹–æ‹½ç§»åŠ¨**ï¼š`data-tauri-drag-region` å±æ€§æ”¯æŒæ‹–æ‹½
- **ä»»åŠ¡æ éšè—**ï¼š`skipTaskbar: true` ä¸åœ¨ä»»åŠ¡æ æ˜¾ç¤º

#### 12.5 ä½¿ç”¨ä½“éªŒ
1. **å¯åŠ¨åº”ç”¨**ï¼š`yarn tauri dev` å¯åŠ¨ä¸»åº”ç”¨
2. **æ˜¾ç¤ºå°ç»„ä»¶**ï¼šç‚¹å‡»ä¸»åº”ç”¨ä¸­çš„"æ˜¾ç¤ºæ¡Œé¢å°ç»„ä»¶"æŒ‰é’®
3. **æ‹–æ‹½å®šä½**ï¼šæ‹–æ‹½å°ç»„ä»¶æ ‡é¢˜æ ç§»åŠ¨åˆ°åˆé€‚ä½ç½®
4. **å¸¸é©»æ¡Œé¢**ï¼šå°ç»„ä»¶ä¼šä¿æŒåœ¨æ¡Œé¢æœ€å‰æ–¹æ˜¾ç¤º

è¿™æ ·å®ç°çš„æ¡Œé¢å°ç»„ä»¶çœŸæ­£é›†æˆåˆ°äº† Tauri åº”ç”¨ä¸­ï¼Œæä¾›äº†åŸç”Ÿçš„ Windows æ¡Œé¢ä½“éªŒã€‚

### 14. æ¡Œé¢å°ç»„ä»¶å±‚çº§é—®é¢˜ä¿®å¤

#### 14.1 é—®é¢˜å‘ç°
å°è¯•å°†çª—å£è®¾ç½®ä¸º Explorer å­çª—å£æ—¶å‡ºç°çª—å£æ¶ˆå¤±çš„é—®é¢˜ï¼š
- `SetParent(hwnd, progman_hwnd)` å¯¼è‡´çª—å£ä¸å¯è§
- å¤æ‚çš„çˆ¶å­çª—å£å…³ç³»å¯èƒ½å¯¼è‡´æ„å¤–è¡Œä¸º

#### 14.2 è§£å†³æ–¹æ¡ˆ
é‡‡ç”¨æ›´ç®€å•å®‰å…¨çš„æ–¹æ³•ï¼š
```rust
// åªä½¿ç”¨ SetWindowPos è®¾ç½®çª—å£å±‚çº§ï¼Œä¸è®¾ç½®çˆ¶çª—å£
SetWindowPos(
    hwnd,
    HWND_BOTTOM,  // è®¾ç½®åˆ°æœ€åº•å±‚
    0, 0, 0, 0,
    SWP_NOMOVE | SWP_NOSIZE | SWP_NOACTIVATE
);
```

#### 14.3 æ•ˆæœ
- âœ… çª—å£æ­£å¸¸æ˜¾ç¤ºï¼Œä¸ä¼šæ¶ˆå¤±
- âœ… è®¾ç½®åˆ°æ¡Œé¢å±‚çº§ï¼ˆHWND_BOTTOMï¼‰
- âœ… ä¸å¹²æ‰°å…¶ä»–åº”ç”¨çª—å£
- âœ… ä¿æŒæ¡Œé¢å°ç»„ä»¶çš„åŸºæœ¬è¡Œä¸º

è™½ç„¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„ Explorer å­çª—å£ï¼Œä½†å®ç°äº†æ¡Œé¢å°ç»„ä»¶çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

### 15. æ‹–æ‹½åŠŸèƒ½å’Œé˜´å½±æ•ˆæœä¿®å¤

#### 15.1 æ‹–æ‹½åŠŸèƒ½å®ç°
ä¿®å¤äº†ç§»åŠ¨æ¨¡å¼ä¸‹çš„æ‹–æ‹½åŠŸèƒ½ï¼š

**å‰ç«¯å®ç°ï¼š**
```vue
<!-- åŠ¨æ€è®¾ç½®æ‹–æ‹½åŒºåŸŸ -->
<div class="widget-header" :data-tauri-drag-region="moveMode ? 'true' : 'false'">
```

**åç«¯å®ç°ï¼š**
```rust
// å¯ç”¨æ‹–æ‹½æ—¶æå‡çª—å£å±‚çº§
SetWindowPos(hwnd, HWND_TOP, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE | SWP_NOACTIVATE);

// ç¦ç”¨æ‹–æ‹½æ—¶æ¢å¤æ¡Œé¢å±‚çº§
SetWindowPos(hwnd, HWND_BOTTOM, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE | SWP_NOACTIVATE);
```

#### 15.2 é˜´å½±æ•ˆæœç§»é™¤
å®Œå…¨å»æ‰äº†çª—å£æ¿€æ´»æ—¶çš„é˜´å½±æ•ˆæœï¼š

**Tauri é…ç½®ï¼š**
```json
{
  "shadow": false,
  "focus": false
}
```

**CSS æ ·å¼ï¼š**
```css
.desktop-widget {
  box-shadow: none;  /* å®Œå…¨ç§»é™¤é˜´å½± */
}
```

#### 15.3 ç”¨æˆ·ä½“éªŒæ”¹è¿›
- âœ… **çœŸæ­£çš„æ‹–æ‹½**ï¼šç§»åŠ¨æ¨¡å¼ä¸‹å¯ä»¥æ‹–æ‹½æ ‡é¢˜æ ç§»åŠ¨çª—å£
- âœ… **æ— é˜´å½±å¹²æ‰°**ï¼šå»æ‰äº†æ¿€æ´»æ—¶çš„é˜´å½±æ•ˆæœ
- âœ… **è§†è§‰åé¦ˆ**ï¼šç§»åŠ¨æ¨¡å¼ä¸‹æ˜¾ç¤ºæ©™è‰²è™šçº¿è¾¹æ¡†
- âœ… **å±‚çº§åˆ‡æ¢**ï¼šç§»åŠ¨æ—¶æå‡å±‚çº§ï¼Œé”å®šæ—¶å›åˆ°æ¡Œé¢å±‚çº§

### 16. çª—å£å±‚çº§é—®é¢˜å½»åº•ä¿®å¤

#### 16.1 é—®é¢˜åˆ†æ
ç”¨æˆ·åé¦ˆçš„æ ¸å¿ƒé—®é¢˜ï¼š
- ç‚¹å‡»å°ç»„ä»¶æ—¶ï¼Œçª—å£ä¼šè¢«æ¿€æ´»å¹¶è¦†ç›–å…¶ä»–åº”ç”¨
- è¿™ä¸æ˜¯çœŸæ­£çš„æ¡Œé¢å°ç»„ä»¶è¡Œä¸º
- æ¡Œé¢å°ç»„ä»¶åº”è¯¥å§‹ç»ˆä¿æŒåœ¨æ¡Œé¢å±‚çº§

#### 16.2 è§£å†³æ–¹æ¡ˆ
å®ç°äº†å¤šå±‚æ¬¡çš„çª—å£å±‚çº§æ§åˆ¶ï¼š

**1. çª—å£æ‰©å±•æ ·å¼è®¾ç½®ï¼š**
```rust
// è®¾ç½®çª—å£ä¸ºä¸å¯æ¿€æ´»çš„å·¥å…·çª—å£
let ex_style = GetWindowLongW(hwnd, GWL_EXSTYLE);
SetWindowLongW(hwnd, GWL_EXSTYLE,
    ex_style | WS_EX_NOACTIVATE.0 as i32 | WS_EX_TOOLWINDOW.0 as i32);
```

**2. å¼ºåˆ¶æ¡Œé¢å±‚çº§ï¼š**
```rust
// å§‹ç»ˆä¿æŒåœ¨åº•å±‚
SetWindowPos(hwnd, HWND_BOTTOM, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE | SWP_NOACTIVATE);
```

**3. å®šæœŸå±‚çº§æ£€æŸ¥ï¼š**
```javascript
// æ¯2ç§’å¼ºåˆ¶æ£€æŸ¥å¹¶ä¿æŒæ¡Œé¢å±‚çº§
setInterval(() => {
  if (!moveMode.value) {
    invoke('force_desktop_level');
  }
}, 2000);
```

#### 16.3 æ•ˆæœ
- âœ… **çœŸæ­£çš„æ¡Œé¢å°ç»„ä»¶**ï¼šç‚¹å‡»ä¸ä¼šè¦†ç›–å…¶ä»–çª—å£
- âœ… **å§‹ç»ˆåœ¨åº•å±‚**ï¼šå…¶ä»–åº”ç”¨çª—å£å§‹ç»ˆåœ¨å°ç»„ä»¶ä¸Šæ–¹
- âœ… **ä¸å¹²æ‰°å·¥ä½œ**ï¼šå®Œå…¨ä¸å½±å“æ­£å¸¸çš„çª—å£æ“ä½œ
- âœ… **ä¿æŒåŠŸèƒ½**ï¼šç§»åŠ¨æ¨¡å¼ä¸‹ä»å¯æ‹–æ‹½ï¼Œä½†ä¸ä¼šç ´åå±‚çº§

### 17. æ‹–æ‹½æƒé™é—®é¢˜å‘ç°ä¸ä¿®å¤

#### 17.1 é—®é¢˜å‘ç°
é€šè¿‡è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—åˆ†æï¼Œå‘ç°äº†æ‹–æ‹½åŠŸèƒ½ä¸å·¥ä½œçš„æ ¹æœ¬åŸå› ï¼š

**é”™è¯¯ä¿¡æ¯ï¼š**
```
VM11:306 Uncaught (in promise) window.start_dragging not allowed.
Permissions associated with this command: core:window:allow-start-dragging
```

**é—®é¢˜åˆ†æï¼š**
- åç«¯çš„çª—å£æ ·å¼è®¾ç½®å®Œå…¨æ­£å¸¸
- `WS_EX_NOACTIVATE` æ ·å¼æ­£ç¡®åˆ‡æ¢
- é—®é¢˜å‡ºåœ¨ Tauri çš„æƒé™ç³»ç»Ÿä¸Š

#### 17.2 æƒé™ä¿®å¤
åœ¨ `src-tauri/capabilities/default.json` ä¸­æ·»åŠ å¿…è¦æƒé™ï¼š

```json
{
  "windows": ["main", "widget"],
  "permissions": [
    "core:default",
    "opener:default",
    "core:window:allow-start-dragging",
    "core:window:allow-set-position",
    "core:window:allow-set-size"
  ]
}
```

#### 17.3 è°ƒè¯•è¿‡ç¨‹
æ·»åŠ äº†å…¨é¢çš„è°ƒè¯•æ—¥å¿—ï¼š
- **åç«¯æ—¥å¿—**ï¼šçª—å£å¥æŸ„ã€æ ·å¼åˆ‡æ¢ã€APIè°ƒç”¨çŠ¶æ€
- **å‰ç«¯æ—¥å¿—**ï¼šç§»åŠ¨æ¨¡å¼åˆ‡æ¢ã€DOMå±æ€§æ£€æŸ¥ã€é¼ æ ‡äº‹ä»¶
- **æƒé™æ£€æŸ¥**ï¼šå‘ç°äº†æƒé™ä¸è¶³çš„æ ¹æœ¬é—®é¢˜

#### 17.4 ä¿®å¤æ•ˆæœ
æƒé™ä¿®å¤åï¼Œæ‹–æ‹½åŠŸèƒ½åº”è¯¥èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼š
- âœ… **æƒé™é—®é¢˜è§£å†³**ï¼šæ·»åŠ äº† `core:window:allow-start-dragging` æƒé™
- âœ… **çª—å£æ ·å¼æ­£å¸¸**ï¼š`WS_EX_NOACTIVATE` æ­£ç¡®åˆ‡æ¢
- âœ… **è°ƒè¯•ä¿¡æ¯å®Œæ•´**ï¼šä¾¿äºåç»­é—®é¢˜æ’æŸ¥

### 18. ä¸»çª—å£å…³é—­é”€æ¯é—®é¢˜ä¿®å¤

#### 18.1 é—®é¢˜æè¿°
ç”¨æˆ·åé¦ˆä¸»çª—å£åªèƒ½æ‰“å¼€ä¸€æ¬¡ï¼Œç‚¹å‡» X å…³é—­åå°±æ— æ³•å†æ¬¡æ‰“å¼€ã€‚

**é—®é¢˜åŸå› ï¼š**
- Tauri é»˜è®¤è¡Œä¸ºï¼šç‚¹å‡» X æŒ‰é’®ä¼šé”€æ¯çª—å£
- çª—å£ä¸€æ—¦é”€æ¯å°±æ— æ³•å†æ¬¡æ˜¾ç¤º
- éœ€è¦æ‹¦æˆªå…³é—­äº‹ä»¶ï¼Œæ”¹ä¸ºéšè—çª—å£

#### 18.2 è§£å†³æ–¹æ¡ˆ
å®ç°çª—å£å…³é—­äº‹ä»¶æ‹¦æˆªï¼š

```rust
// è®¾ç½®ä¸»çª—å£å…³é—­äº‹ä»¶å¤„ç†
if let Some(main_window) = app.get_webview_window("main") {
    let main_window_clone = main_window.clone();
    main_window.on_window_event(move |event| {
        if let tauri::WindowEvent::CloseRequested { api, .. } = event {
            // é˜»æ­¢é»˜è®¤çš„å…³é—­è¡Œä¸º
            api.prevent_close();
            // éšè—çª—å£è€Œä¸æ˜¯é”€æ¯
            let _ = main_window_clone.hide();
        }
    });
}
```

#### 18.3 ä¿®å¤æ•ˆæœ
- âœ… **å¯é‡å¤æ‰“å¼€**ï¼šä¸»çª—å£å¯ä»¥å¤šæ¬¡æ‰“å¼€å’Œå…³é—­
- âœ… **çŠ¶æ€ä¿æŒ**ï¼šçª—å£å†…å®¹å’ŒçŠ¶æ€å¾—åˆ°ä¿ç•™
- âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šç¬¦åˆæ¡Œé¢åº”ç”¨çš„å¸¸è§è¡Œä¸º
- âœ… **è°ƒè¯•ç¡®è®¤**ï¼šæ—¥å¿—æ˜¾ç¤º"éšè—çª—å£è€Œä¸æ˜¯é”€æ¯"

### 19. ä¸»ç•Œé¢ä¸€å‘¨è§†å›¾é‡æ„

#### 19.1 éœ€æ±‚å˜æ›´
ç”¨æˆ·è¦æ±‚å°†ä¸»ç•Œé¢çš„è¯¾ç¨‹è¡¨æ›´æ–°ä¸ºï¼š
- å…¨å®½åº¦æ˜¾ç¤º
- æ˜¾ç¤ºå®Œæ•´ä¸€å‘¨çš„è¯¾ç¨‹å®‰æ’
- æ›´ç›´è§‚çš„ç½‘æ ¼å¸ƒå±€

#### 19.2 è®¾è®¡æ–¹æ¡ˆ
é‡æ–°è®¾è®¡äº† `ScheduleDisplay.vue` ç»„ä»¶ï¼š

**å¸ƒå±€ç»“æ„ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚æ—¶é—´ â”‚ å‘¨ä¸€â”‚ å‘¨äºŒâ”‚ å‘¨ä¸‰â”‚ å‘¨å››â”‚ å‘¨äº”â”‚ å‘¨å…­â”‚ å‘¨æ—¥â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚08:00â”‚     â”‚è¯¾ç¨‹ â”‚     â”‚è¯¾ç¨‹ â”‚     â”‚     â”‚     â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚09:00â”‚è¯¾ç¨‹ â”‚     â”‚è¯¾ç¨‹ â”‚     â”‚è¯¾ç¨‹ â”‚     â”‚     â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

#### 19.3 æ ¸å¿ƒåŠŸèƒ½
**1. æ—¶é—´è½´æ˜¾ç¤ºï¼š**
- å·¦ä¾§å›ºå®šæ—¶é—´è½´ï¼ˆ08:00-22:00ï¼‰
- å½“å‰æ—¶é—´æ®µé«˜äº®æ˜¾ç¤º
- æ¯å°æ—¶ä¸€ä¸ªæ—¶é—´æ®µ

**2. ä¸€å‘¨å¸ƒå±€ï¼š**
- 7åˆ—æ˜¾ç¤ºå‘¨ä¸€åˆ°å‘¨æ—¥
- ä»Šå¤©çš„åˆ—æœ‰ç‰¹æ®Šé«˜äº®
- æ˜¾ç¤ºæ—¥æœŸä¿¡æ¯

**3. è¯¾ç¨‹å¡ç‰‡ï¼š**
- å½©è‰²è¯¾ç¨‹å¡ç‰‡ï¼Œæ”¯æŒè‡ªå®šä¹‰é¢œè‰²
- æ˜¾ç¤ºè¯¾ç¨‹åç§°ã€æ—¶é—´ã€æ•™å¸ˆã€åœ°ç‚¹
- æ ¹æ®è¯¾ç¨‹æ—¶é•¿åŠ¨æ€è°ƒæ•´é«˜åº¦
- å½“å‰è¯¾ç¨‹è„‰å†²åŠ¨ç”»æ•ˆæœ

**4. çŠ¶æ€æŒ‡ç¤ºï¼š**
- æ­£åœ¨è¿›è¡Œï¼šç™½è‰²è¾¹æ¡†è„‰å†²åŠ¨ç”»
- å·²ç»“æŸï¼šåŠé€æ˜ + ç°åº¦æ»¤é•œ
- å³å°†å¼€å§‹ï¼šæ­£å¸¸æ˜¾ç¤º

#### 19.4 æŠ€æœ¯å®ç°
**å“åº”å¼æ•°æ®ï¼š**
```javascript
const weekDays = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
const timeSlots = ['08:00', '09:00', ..., '22:00'];
const weekCourses = computed(() => æœ¬å‘¨æ‰€æœ‰è¯¾ç¨‹);
```

**æ™ºèƒ½å¸ƒå±€ï¼š**
- `getCoursesForDayAndTime()`: è·å–ç‰¹å®šæ—¥æœŸæ—¶é—´çš„è¯¾ç¨‹
- `getCourseDuration()`: æ ¹æ®è¯¾ç¨‹æ—¶é•¿è®¡ç®—å¡ç‰‡é«˜åº¦
- `isToday()`: åˆ¤æ–­æ˜¯å¦ä¸ºä»Šå¤©
- `formatDate()`: æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º

#### 19.5 ç”¨æˆ·ä½“éªŒ
- âœ… **å…¨å®½åº¦åˆ©ç”¨**ï¼šå……åˆ†åˆ©ç”¨ä¸»çª—å£ç©ºé—´
- âœ… **ä¸€ç›®äº†ç„¶**ï¼šæ•´å‘¨è¯¾ç¨‹å®‰æ’æ¸…æ™°å¯è§
- âœ… **ä»Šæ—¥çªå‡º**ï¼šå½“å¤©åˆ—æœ‰è“è‰²èƒŒæ™¯
- âœ… **å®æ—¶çŠ¶æ€**ï¼šè¯¾ç¨‹çŠ¶æ€å®æ—¶æ›´æ–°
- âœ… **å“åº”å¼è®¾è®¡**ï¼šé€‚åº”ä¸åŒçª—å£å¤§å°

### 20. æ—¥å¿—ç³»ç»Ÿé‡æ„ä¸º env_logger

#### 20.1 é‡æ„ç›®æ ‡
å°†æ‰€æœ‰çš„ `println!` è°ƒè¯•æ—¥å¿—é‡æ„ä¸ºä½¿ç”¨ `env_logger`ï¼Œæä¾›æ›´ä¸“ä¸šçš„æ—¥å¿—ç®¡ç†ï¼š
- æ”¯æŒæ—¥å¿—çº§åˆ«æ§åˆ¶
- æ›´å¥½çš„æ—¥å¿—æ ¼å¼
- å¯é…ç½®çš„æ—¥å¿—è¾“å‡º

#### 20.2 æŠ€æœ¯å®ç°

**1. æ·»åŠ ä¾èµ–ï¼š**
```toml
[dependencies]
log = "0.4"
env_logger = "0.11"
```

**2. æ—¥å¿—çº§åˆ«åˆ†ç±»ï¼š**
```rust
use log::{info, debug, warn, error};

// åº”ç”¨ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
info!("åº”ç”¨å¯åŠ¨ï¼Œåˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ");
info!("ä¸»çª—å£å·²æ˜¾ç¤ºå¹¶è·å¾—ç„¦ç‚¹");

// è°ƒè¯•ä¿¡æ¯
debug!("æ‰¾åˆ°ä¸»çª—å£ï¼Œå‡†å¤‡æ˜¾ç¤º");
debug!("å½“å‰æ‰©å±•æ ·å¼: 0x{:x}", ex_style);

// è­¦å‘Šä¿¡æ¯
warn!("æœªæ‰¾åˆ°ä¸»çª—å£");
warn!("æœªæ‰¾åˆ° widget çª—å£");

// é”™è¯¯ä¿¡æ¯
error!("æ˜¾ç¤ºä¸»çª—å£å¤±è´¥: {}", e);
error!("è®¾ç½®ä¸»çª—å£ç„¦ç‚¹å¤±è´¥: {}", e);
```

**3. æ—¥å¿—åˆå§‹åŒ–ï¼š**
```rust
env_logger::Builder::from_default_env()
    .filter_level(log::LevelFilter::Info)
    .init();
```

#### 20.3 æ—¥å¿—çº§åˆ«æ§åˆ¶

**ç¯å¢ƒå˜é‡é…ç½®ï¼š**
```bash
# .env æ–‡ä»¶
RUST_LOG=info    # é»˜è®¤çº§åˆ«
RUST_LOG=debug   # å¼€å‘è°ƒè¯•
RUST_LOG=error   # ç”Ÿäº§ç¯å¢ƒ
```

**æ—¥å¿—çº§åˆ«è¯´æ˜ï¼š**
- `error`: åªæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- `warn`: æ˜¾ç¤ºè­¦å‘Šå’Œé”™è¯¯
- `info`: æ˜¾ç¤ºä¿¡æ¯ã€è­¦å‘Šå’Œé”™è¯¯ï¼ˆé»˜è®¤ï¼‰
- `debug`: æ˜¾ç¤ºæ‰€æœ‰è°ƒè¯•ä¿¡æ¯
- `trace`: æœ€è¯¦ç»†çš„æ—¥å¿—çº§åˆ«

#### 20.4 ä¼˜åŠ¿
- âœ… **ä¸“ä¸šæ—¥å¿—ç®¡ç†**ï¼šæ›¿ä»£ç®€å•çš„ println! è°ƒè¯•
- âœ… **çº§åˆ«æ§åˆ¶**ï¼šå¯æ ¹æ®ç¯å¢ƒè°ƒæ•´æ—¥å¿—è¯¦ç»†ç¨‹åº¦
- âœ… **æ ¼å¼ç»Ÿä¸€**ï¼šæ ‡å‡†çš„æ—¥å¿—æ ¼å¼å’Œæ—¶é—´æˆ³
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šç”Ÿäº§ç¯å¢ƒå¯å…³é—­è°ƒè¯•æ—¥å¿—
- âœ… **å¼€å‘å‹å¥½**ï¼šå¼€å‘æ—¶å¯å¯ç”¨è¯¦ç»†è°ƒè¯•ä¿¡æ¯

### 21. æ¡Œé¢å°ç»„ä»¶è§†è§‰å¯¹æ¯”åº¦ä¼˜åŒ–

#### 21.1 é—®é¢˜åé¦ˆ
ç”¨æˆ·åé¦ˆæ¡Œé¢å°ç»„ä»¶çš„è¯¾ç¨‹å¡ç‰‡é¢œè‰²å¤ªæ·¡ï¼Œåœ¨æ¡Œé¢ä¸Šå‡ ä¹çœ‹ä¸æ¸…æ¥šï¼Œå½±å“å®ç”¨æ€§ã€‚

#### 21.2 ä¼˜åŒ–æ–¹æ¡ˆ
å…¨é¢æå‡å°ç»„ä»¶çš„è§†è§‰å¯¹æ¯”åº¦å’Œå¯è¯»æ€§ï¼š

**1. èƒŒæ™¯å¯¹æ¯”åº¦æå‡ï¼š**
```css
/* ä»åŠé€æ˜æ”¹ä¸ºé«˜é€æ˜åº¦ */
background: rgba(255, 255, 255, 0.98);  /* åŸæ¥ 0.95 */

/* æ·»åŠ æ›´æ˜æ˜¾çš„é˜´å½±å’Œè¾¹æ¡† */
box-shadow:
  0 4px 20px rgba(0, 0, 0, 0.15),
  0 1px 4px rgba(0, 0, 0, 0.1);
border: 1px solid rgba(0, 0, 0, 0.1);
```

**2. è¯¾ç¨‹çŠ¶æ€é¢œè‰²å¢å¼ºï¼š**
```css
/* æ­£åœ¨è¿›è¡Œçš„è¯¾ç¨‹ */
.current-course {
  background: rgba(39, 174, 96, 0.25);  /* åŸæ¥ 0.15 */
  border-color: rgba(39, 174, 96, 0.8);  /* åŸæ¥ 0.4 */
  border-width: 2px;  /* æ–°å¢åŠ ç²—è¾¹æ¡† */
}

/* å³å°†å¼€å§‹çš„è¯¾ç¨‹ */
.upcoming-course {
  background: rgba(243, 156, 18, 0.25);
  border-color: rgba(243, 156, 18, 0.8);
  border-width: 2px;
}
```

**3. æ–‡å­—é¢œè‰²æ·±åŒ–ï¼š**
```css
/* ä¸»è¦æ–‡å­— */
color: #1a202c;  /* åŸæ¥ #2c3e50 */

/* æ¬¡è¦æ–‡å­— */
color: #4a5568;  /* åŸæ¥ #7f8c8d */
```

**4. åŠ¨ç”»æ•ˆæœå¢å¼ºï¼š**
```css
@keyframes currentPulse {
  0%, 100% {
    box-shadow: 0 2px 8px rgba(39, 174, 96, 0.4);  /* åŸæ¥ 0.2 */
    border-color: rgba(39, 174, 96, 0.8);
  }
  50% {
    box-shadow: 0 4px 16px rgba(39, 174, 96, 0.6);  /* åŸæ¥ 0.4 */
    border-color: rgba(39, 174, 96, 1);
  }
}
```

#### 21.3 ä¼˜åŒ–æ•ˆæœ
- âœ… **é«˜å¯¹æ¯”åº¦**ï¼šç™½è‰²èƒŒæ™¯é€æ˜åº¦æå‡åˆ° 98%
- âœ… **é²œè‰³çŠ¶æ€**ï¼šè¯¾ç¨‹çŠ¶æ€é¢œè‰²é¥±å’Œåº¦æå‡ 60%
- âœ… **æ¸…æ™°æ–‡å­—**ï¼šä½¿ç”¨æ›´æ·±çš„æ–‡å­—é¢œè‰²æå‡å¯è¯»æ€§
- âœ… **æ˜æ˜¾è¾¹æ¡†**ï¼šé‡è¦çŠ¶æ€ä½¿ç”¨ 2px ç²—è¾¹æ¡†
- âœ… **å¢å¼ºåŠ¨ç”»**ï¼šè„‰å†²æ•ˆæœæ›´åŠ æ˜æ˜¾
- âœ… **æ¡Œé¢å¯è§**ï¼šåœ¨å„ç§æ¡Œé¢èƒŒæ™¯ä¸‹éƒ½æ¸…æ™°å¯è§

### 22. ä¸»çª—å£è‡ªé€‚åº”å’Œå°ç»„ä»¶ä½ç½®è®°å¿†

#### 22.1 ä¸»çª—å£è‡ªé€‚åº”ä¼˜åŒ–
è§£å†³ä¸»çª—å£è¯¾ç¨‹è¡¨å‡ºç°æ»šåŠ¨æ¡çš„é—®é¢˜ï¼š

**é—®é¢˜åˆ†æï¼š**
- å›ºå®šé«˜åº¦ `calc(100vh - 250px)` ä¸é€‚åº”çª—å£å¤§å°å˜åŒ–
- ç¼ºå°‘å¼¹æ€§å¸ƒå±€å¯¼è‡´å†…å®¹æº¢å‡º

**è§£å†³æ–¹æ¡ˆï¼š**
```css
.schedule-display {
  display: flex;
  flex-direction: column;  /* å‚ç›´å¼¹æ€§å¸ƒå±€ */
}

.weekly-schedule {
  height: calc(100% - 120px);  /* ç›¸å¯¹äºå®¹å™¨é«˜åº¦ */
  min-height: 400px;  /* æœ€å°é«˜åº¦ä¿è¯ */
}

.day-column {
  display: flex;
  flex-direction: column;  /* å¤©åˆ—å‚ç›´å¸ƒå±€ */
}

.day-courses {
  flex: 1;  /* è‡ªåŠ¨å¡«å……å‰©ä½™ç©ºé—´ */
  overflow-y: auto;
  min-height: 0;  /* å…è®¸æ”¶ç¼© */
}
```

#### 22.2 å°ç»„ä»¶ä½ç½®è®°å¿†åŠŸèƒ½
å®ç°å°ç»„ä»¶è®°ä½ä¸Šæ¬¡æ‹–æ‹½ä½ç½®ï¼š

**åç«¯å®ç°ï¼š**
```rust
// ä¿å­˜ä½ç½®åˆ°é…ç½®æ–‡ä»¶
#[tauri::command]
fn save_widget_position(app: tauri::AppHandle, x: i32, y: i32) -> Result<(), String> {
    let config_path = app.path().app_data_dir()?.join("widget_position.json");
    let position_data = serde_json::json!({"x": x, "y": y});
    fs::write(&config_path, position_data.to_string())?;
    Ok(())
}

// ä»é…ç½®æ–‡ä»¶æ¢å¤ä½ç½®
#[tauri::command]
fn restore_widget_position(app: tauri::AppHandle) -> Result<(i32, i32), String> {
    let config_path = app.path().app_data_dir()?.join("widget_position.json");
    if config_path.exists() {
        let content = fs::read_to_string(&config_path)?;
        let position: serde_json::Value = serde_json::from_str(&content)?;
        let x = position["x"].as_i64().unwrap_or(100) as i32;
        let y = position["y"].as_i64().unwrap_or(100) as i32;
        Ok((x, y))
    } else {
        Ok((100, 100))  // é»˜è®¤ä½ç½®
    }
}
```

**å‰ç«¯é›†æˆï¼š**
```javascript
// ç§»åŠ¨æ¨¡å¼ç»“æŸæ—¶ä¿å­˜ä½ç½®
async function toggleMoveMode() {
  if (!newMoveMode) {
    await saveCurrentPosition();  // ä¿å­˜å½“å‰ä½ç½®
  }
}

// åº”ç”¨å¯åŠ¨æ—¶æ¢å¤ä½ç½®
onMounted(async () => {
  const [x, y] = await invoke('restore_widget_position');
  // ä½ç½®ä¼šåœ¨ Rust ç«¯è‡ªåŠ¨åº”ç”¨
});
```

**é…ç½®æ–‡ä»¶ä½ç½®ï¼š**
- Windows: `%APPDATA%/class-schedule/widget_position.json`
- è‡ªåŠ¨åˆ›å»ºç›®å½•ç»“æ„
- JSON æ ¼å¼å­˜å‚¨åæ ‡

#### 22.3 ç”¨æˆ·ä½“éªŒæ”¹è¿›
- âœ… **ä¸»çª—å£è‡ªé€‚åº”**ï¼šæ— è®ºçª—å£å¤§å°å¦‚ä½•å˜åŒ–éƒ½ä¸ä¼šå‡ºç°æ»šåŠ¨æ¡
- âœ… **ä½ç½®è®°å¿†**ï¼šå°ç»„ä»¶é‡å¯åå›åˆ°ä¸Šæ¬¡ä½ç½®
- âœ… **æ™ºèƒ½ä¿å­˜**ï¼šåªåœ¨ç§»åŠ¨æ¨¡å¼ç»“æŸæ—¶ä¿å­˜ï¼Œé¿å…é¢‘ç¹å†™å…¥
- âœ… **å®¹é”™å¤„ç†**ï¼šé…ç½®æ–‡ä»¶æŸåæ—¶ä½¿ç”¨é»˜è®¤ä½ç½®
- âœ… **è·¨ä¼šè¯æŒä¹…**ï¼šä½ç½®ä¿¡æ¯æ°¸ä¹…ä¿å­˜

### 23. å½»åº•è§£å†³æ»šåŠ¨æ¡é—®é¢˜å’Œçª—å£æœ€å°å°ºå¯¸

#### 23.1 é—®é¢˜åˆ†æ
ä¸»çª—å£ä»ç„¶å‡ºç°å‚ç›´æ»šåŠ¨æ¡ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚

**æ ¹æœ¬åŸå› ï¼š**
- å›ºå®šé«˜åº¦è®¡ç®—ä¸å‡†ç¡®
- ç¼ºå°‘å®Œæ•´çš„å¼¹æ€§å¸ƒå±€ä½“ç³»
- å®¹å™¨é«˜åº¦æº¢å‡º

#### 23.2 å®Œæ•´è§£å†³æ–¹æ¡ˆ

**1. è®¾ç½®çª—å£æœ€å°å°ºå¯¸ï¼š**
```json
// tauri.conf.json
{
  "width": 1200,
  "height": 800,
  "minWidth": 1000,
  "minHeight": 700
}
```

**2. å®Œæ•´å¼¹æ€§å¸ƒå±€ä½“ç³»ï¼š**
```css
/* æ ¹å®¹å™¨ */
.app {
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;  /* é˜²æ­¢æ•´ä½“æº¢å‡º */
}

/* ä¸»å†…å®¹åŒº */
.app-main {
  flex: 1;  /* è‡ªåŠ¨å¡«å……å‰©ä½™ç©ºé—´ */
  overflow: hidden;
}

/* å¡ç‰‡å®¹å™¨ */
.main-card {
  height: 100%;
  display: flex;
  flex-direction: column;
}

/* Element Plus å¡ç‰‡ä½“ */
:deep(.el-card__body) {
  flex: 1;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}
```

**3. ç»„ä»¶å†…éƒ¨å¸ƒå±€ï¼š**
```css
/* è¯¾ç¨‹è¡¨ç»„ä»¶ */
.schedule-display {
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* ä¸€å‘¨è§†å›¾ */
.weekly-schedule {
  flex: 1;  /* å¡«å……å‰©ä½™ç©ºé—´ */
  min-height: 0;  /* å…è®¸æ”¶ç¼© */
  overflow: hidden;
}

/* å¤©åˆ— */
.day-column {
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* è¯¾ç¨‹åŒºåŸŸ */
.day-courses {
  flex: 1;
  overflow-y: auto;  /* åªåœ¨éœ€è¦æ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡ */
  min-height: 0;
}
```

#### 23.3 å¸ƒå±€å±‚æ¬¡ç»“æ„
```
App (100vh, flex-column)
â”œâ”€â”€ Header (flex-shrink: 0)
â””â”€â”€ Main (flex: 1)
    â””â”€â”€ Card (height: 100%, flex-column)
        â””â”€â”€ Card Body (flex: 1, flex-column)
            â””â”€â”€ ScheduleDisplay (height: 100%, flex-column)
                â”œâ”€â”€ Header (flex-shrink: 0)
                â””â”€â”€ WeeklySchedule (flex: 1)
                    â””â”€â”€ DayColumn (flex-column)
                        â”œâ”€â”€ DayHeader (flex-shrink: 0)
                        â””â”€â”€ DayCourses (flex: 1, overflow-y: auto)
```

#### 23.4 å…³é”®æŠ€æœ¯ç‚¹
- âœ… **flex: 1**ï¼šè‡ªåŠ¨å¡«å……å¯ç”¨ç©ºé—´
- âœ… **min-height: 0**ï¼šå…è®¸ flex å­å…ƒç´ æ”¶ç¼©
- âœ… **overflow: hidden**ï¼šé˜²æ­¢æ„å¤–æ»šåŠ¨æ¡
- âœ… **flex-shrink: 0**ï¼šå›ºå®šå¤´éƒ¨é«˜åº¦
- âœ… **çª—å£æœ€å°å°ºå¯¸**ï¼šä¿è¯åŸºæœ¬å¯ç”¨æ€§

#### 23.5 æœ€ç»ˆæ•ˆæœ
- âœ… **æ— æ»šåŠ¨æ¡**ï¼šä¸»çª—å£å®Œå…¨é€‚åº”ä»»ä½•å°ºå¯¸
- âœ… **å“åº”å¼**ï¼šçª—å£è°ƒæ•´æ—¶å†…å®¹è‡ªåŠ¨é€‚é…
- âœ… **æœ€å°å°ºå¯¸**ï¼šé˜²æ­¢çª—å£è¿‡å°å½±å“ä½¿ç”¨
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šé¿å…ä¸å¿…è¦çš„é‡æ’é‡ç»˜

### 24. åç«¯æ—¥å¿—ç³»ç»Ÿå®Œå–„

#### 24.1 éœ€æ±‚èƒŒæ™¯
åç«¯æœåŠ¡ç¼ºå°‘å®Œå–„çš„æ—¥å¿—ç³»ç»Ÿï¼Œéš¾ä»¥è¿›è¡Œé—®é¢˜æ’æŸ¥å’Œç›‘æ§ã€‚

#### 24.2 æŠ€æœ¯å®ç°

**1. æ·»åŠ æ—¥å¿—ä¾èµ–ï¼š**
```toml
[dependencies]
log = "0.4"
env_logger = "0.10"
```

**2. æœåŠ¡å™¨å¯åŠ¨æ—¥å¿—ï¼š**
```rust
// main.rs
env_logger::Builder::from_default_env()
    .filter_level(log::LevelFilter::Info)
    .init();

info!("ğŸš€ è¯¾ç¨‹è¡¨åç«¯æœåŠ¡å¯åŠ¨ä¸­...");
info!("ğŸ“¡ æœåŠ¡åœ°å€: http://localhost:8080");
info!("ğŸ“‹ API ç«¯ç‚¹: http://localhost:8080/api/v1");
info!("âœ… æœåŠ¡å™¨ç»‘å®šæˆåŠŸ - 127.0.0.1:8080");
info!("ğŸ¯ å¯ç”¨çš„ API ç«¯ç‚¹:");
info!("   GET    /api/v1/schedule     - è·å–è¯¾ç¨‹è¡¨");
info!("   POST   /api/v1/courses      - åˆ›å»ºè¯¾ç¨‹");
// ...
```

**3. API å¤„ç†æ—¥å¿—ï¼š**
```rust
// handlers.rs
#[get("/schedule")]
pub async fn get_schedule() -> Result<HttpResponse> {
    info!("ğŸ“‹ è·å–è¯¾ç¨‹è¡¨è¯·æ±‚");
    // ...
    info!("âœ… è¿”å› {} é—¨è¯¾ç¨‹", schedule.courses.len());
}

#[post("/courses")]
pub async fn create_course(course_req: web::Json<CreateCourseRequest>) -> Result<HttpResponse> {
    info!("â• åˆ›å»ºè¯¾ç¨‹è¯·æ±‚: {}", course_req.name);
    debug!("è¯¾ç¨‹è¯¦æƒ…: æ•™å¸ˆ={:?}, åœ°ç‚¹={:?}, æ˜ŸæœŸ={}, æ—¶é—´={}~{}", ...);
    // ...
    info!("âœ… è¯¾ç¨‹åˆ›å»ºæˆåŠŸ: {} (ID: {})", created_course.name, created_course.id);
}
```

**4. å­˜å‚¨å±‚æ—¥å¿—ï¼š**
```rust
// storage.rs
pub fn create_storage() -> Storage {
    info!("ğŸ’¾ åˆå§‹åŒ–å†…å­˜å­˜å‚¨");
    Arc::new(Mutex::new(HashMap::new()))
}

pub fn insert_course(storage: &Storage, course: Course) -> Course {
    // ...
    debug!("ğŸ’¾ è¯¾ç¨‹å·²å­˜å‚¨: {} (ID: {})", course.name, course.id);
    course
}
```

#### 24.3 æ—¥å¿—çº§åˆ«é…ç½®

**ç¯å¢ƒå˜é‡æ§åˆ¶ï¼š**
```bash
# .env æ–‡ä»¶
RUST_LOG=info    # é»˜è®¤çº§åˆ«
RUST_LOG=debug   # å¼€å‘è°ƒè¯•
RUST_LOG=warn    # ç”Ÿäº§ç¯å¢ƒ
```

**æ—¥å¿—çº§åˆ«è¯´æ˜ï¼š**
- `info`: ä¸šåŠ¡æ“ä½œæ—¥å¿—ï¼ˆé»˜è®¤ï¼‰
- `debug`: è¯¦ç»†è°ƒè¯•ä¿¡æ¯
- `warn`: è­¦å‘Šä¿¡æ¯ï¼ˆå¦‚èµ„æºæœªæ‰¾åˆ°ï¼‰
- `error`: é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æ“ä½œå¤±è´¥ï¼‰

#### 24.4 æ—¥å¿—è¾“å‡ºç¤ºä¾‹

**æœåŠ¡å¯åŠ¨ï¼š**
```
[2025-06-16T10:49:39Z INFO  class_schedule_backend] ğŸš€ è¯¾ç¨‹è¡¨åç«¯æœåŠ¡å¯åŠ¨ä¸­...
[2025-06-16T10:49:39Z INFO  class_schedule_backend] ğŸ“¡ æœåŠ¡åœ°å€: http://localhost:8080
[2025-06-16T10:49:39Z INFO  class_schedule_backend] âœ… æœåŠ¡å™¨ç»‘å®šæˆåŠŸ - 127.0.0.1:8080
```

**API è¯·æ±‚ï¼š**
```
[2025-06-16T10:50:12Z INFO  class_schedule_backend::handlers] ğŸ“‹ è·å–è¯¾ç¨‹è¡¨è¯·æ±‚
[2025-06-16T10:50:12Z INFO  class_schedule_backend::storage] ğŸ’¾ åˆå§‹åŒ–å†…å­˜å­˜å‚¨
[2025-06-16T10:50:12Z INFO  class_schedule_backend::handlers] âœ… è¿”å› 0 é—¨è¯¾ç¨‹
```

**HTTP è®¿é—®æ—¥å¿—ï¼š**
```
[2025-06-16T10:50:12Z INFO  actix_web::middleware::logger] 127.0.0.1 "GET /api/v1/schedule HTTP/1.1" 200 14 "-" "..." 0.000224
```

#### 24.5 ä¼˜åŠ¿
- âœ… **å®Œæ•´è¿½è¸ª**ï¼šä»è¯·æ±‚åˆ°å“åº”çš„å®Œæ•´æ—¥å¿—é“¾è·¯
- âœ… **åˆ†çº§ç®¡ç†**ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒæ—¥å¿—çº§åˆ«
- âœ… **æ˜“äºè°ƒè¯•**ï¼šè¯¦ç»†çš„æ“ä½œæ—¥å¿—ä¾¿äºé—®é¢˜æ’æŸ¥
- âœ… **æ€§èƒ½ç›‘æ§**ï¼šHTTP è®¿é—®æ—¥å¿—åŒ…å«å“åº”æ—¶é—´
- âœ… **æ ‡å‡†æ ¼å¼**ï¼šä½¿ç”¨ Rust ç”Ÿæ€æ ‡å‡†çš„æ—¥å¿—æ ¼å¼

#### 12.6 æ ·å¼ä¼˜åŒ– - å»é™¤å¤–å±‚è£…é¥°
æ ¹æ®ç”¨æˆ·åé¦ˆï¼Œç§»é™¤äº†æ¡Œé¢å°ç»„ä»¶å¤–å±‚çš„é€æ˜è£…é¥°è¾¹æ¡†ï¼š

**ä¿®æ”¹å†…å®¹ï¼š**
- ç§»é™¤å¤–å±‚ paddingï¼Œè®©å†…å®¹å¡«æ»¡æ•´ä¸ªçª—å£
- å»æ‰ `::before` ä¼ªå…ƒç´ çš„æ¸å˜è£…é¥°å±‚
- ç®€åŒ–é˜´å½±æ•ˆæœï¼Œå‡å°‘è§†è§‰å¹²æ‰°
- è°ƒæ•´å†…è¾¹è·åˆ†å¸ƒï¼Œè®©å†…å®¹æ›´ç´§å‡‘

**æ•ˆæœï¼š**
- æ›´åŠ ç®€æ´çš„å¤–è§‚ï¼Œæ²¡æœ‰å¤šä½™çš„é€æ˜è¾¹æ¡†
- å†…å®¹åŒºåŸŸæœ€å¤§åŒ–åˆ©ç”¨
- æ›´ç¬¦åˆ Windows åŸç”Ÿå°ç»„ä»¶çš„è®¾è®¡é£æ ¼

### 13. çœŸæ­£çš„æ¡Œé¢å°ç»„ä»¶å®ç°

#### 13.1 é—®é¢˜è¯†åˆ«
ç”¨æˆ·æŒ‡å‡ºä¹‹å‰çš„å®ç°ä¸æ˜¯çœŸæ­£çš„æ¡Œé¢å°ç»„ä»¶ï¼š
- ç½®é¡¶çª—å£ï¼ˆalwaysOnTopï¼‰ä¸æ˜¯æ¡Œé¢å°ç»„ä»¶çš„æ­£ç¡®è¡Œä¸º
- çœŸæ­£çš„æ¡Œé¢å°ç»„ä»¶åº”è¯¥æ˜¾ç¤ºåœ¨æ¡Œé¢å£çº¸ä¸Šæ–¹ï¼Œä½†åœ¨å…¶ä»–çª—å£ä¸‹æ–¹

#### 13.2 Windows æ¡Œé¢å°ç»„ä»¶å®ç°
ä½¿ç”¨ Windows API å®ç°çœŸæ­£çš„æ¡Œé¢å°ç»„ä»¶æ•ˆæœï¼š

**Cargo.toml ä¾èµ–ï¼š**
```toml
[target.'cfg(windows)'.dependencies]
windows = { version = "0.58", features = [
    "Win32_Foundation",
    "Win32_UI_WindowsAndMessaging",
    "Win32_System_LibraryLoader"
] }
```

**Rust å®ç°ï¼š**
```rust
#[cfg(target_os = "windows")]
fn set_desktop_widget_mode(app: tauri::AppHandle) -> Result<(), String> {
    // ä½¿ç”¨ SetWindowPos å’Œ HWND_BOTTOM å°†çª—å£è®¾ç½®åˆ°æ¡Œé¢å±‚çº§
    SetWindowPos(hwnd, HWND_BOTTOM, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE | SWP_NOACTIVATE)
}
```

#### 13.3 é…ç½®è°ƒæ•´
- `alwaysOnTop: false` - ä¸å†ç½®é¡¶
- `skipTaskbar: true` - ä¸åœ¨ä»»åŠ¡æ æ˜¾ç¤º
- å°ç»„ä»¶ä½œä¸ºä¸»çª—å£å¯åŠ¨
- æ·»åŠ ç§»åŠ¨æŒ‰é’®å’Œè®¾ç½®æŒ‰é’®

#### 13.4 Explorer å­çª—å£å®ç°
æ ¹æ®ç”¨æˆ·å»ºè®®ï¼Œå®ç°äº†çœŸæ­£çš„æ¡Œé¢å°ç»„ä»¶å±‚çº§ï¼š

**æ ¸å¿ƒå®ç°ï¼š**
```rust
// æŸ¥æ‰¾ Windows Explorer çš„æ¡Œé¢çª—å£
let progman_hwnd = FindWindowW(
    windows::core::w!("Progman"),
    windows::core::w!("Program Manager")
);

// å°†å°ç»„ä»¶è®¾ç½®ä¸º Explorer çš„å­çª—å£
SetParent(hwnd, progman_hwnd);
```

**å±‚çº§å…³ç³»ï¼š**
- å°ç»„ä»¶æˆä¸º Windows Explorer (Progman) çš„å­çª—å£
- æ˜¾ç¤ºåœ¨æ¡Œé¢å£çº¸ä¸Šæ–¹ï¼Œä½†åœ¨æ‰€æœ‰åº”ç”¨çª—å£ä¸‹æ–¹
- çœŸæ­£çš„æ¡Œé¢å°ç»„ä»¶è¡Œä¸ºï¼Œä¸ä¼šå¹²æ‰°æ­£å¸¸å·¥ä½œ

#### 13.5 ç§»åŠ¨æ¨¡å¼å®ç°
- **ç§»åŠ¨æŒ‰é’®**ï¼šğŸ“/ğŸ”’ å›¾æ ‡åˆ‡æ¢ï¼Œæ¿€æ´»/é”å®šç§»åŠ¨æ¨¡å¼
- **è§†è§‰åé¦ˆ**ï¼šç§»åŠ¨æ¨¡å¼ä¸‹æ˜¾ç¤ºæ©™è‰²è™šçº¿è¾¹æ¡†å’Œæç¤º
- **æ‹–æ‹½åŠŸèƒ½**ï¼šç§»åŠ¨æ¨¡å¼ä¸‹å¯æ‹–æ‹½æ ‡é¢˜æ ç§»åŠ¨ä½ç½®
- **è®¾ç½®æŒ‰é’®**ï¼šâš™ï¸ å›¾æ ‡ï¼Œæ‰“å¼€ä¸»åº”ç”¨è¿›è¡Œè®¾ç½®

#### 13.6 ç”¨æˆ·ä½“éªŒ
- **å¯åŠ¨å³æ˜¾ç¤º**ï¼šåº”ç”¨å¯åŠ¨æ—¶ç›´æ¥æ˜¾ç¤ºæ¡Œé¢å°ç»„ä»¶
- **çœŸæ­£æ¡Œé¢é›†æˆ**ï¼šä½œä¸º Explorer å­çª—å£ï¼Œå®Œç¾èå…¥æ¡Œé¢ç¯å¢ƒ
- **ä¸å¹²æ‰°å·¥ä½œ**ï¼šå…¶ä»–åº”ç”¨çª—å£å¯ä»¥æ­£å¸¸è¦†ç›–å°ç»„ä»¶

### 25. ä¸»é¡µè¯¾è¡¨æ˜¾ç¤ºé—®é¢˜ä¿®å¤ (2025-06-16)

#### 25.1 é—®é¢˜è¯Šæ–­
ç”¨æˆ·åé¦ˆä¸»é¡µè¯¾è¡¨å®Œå…¨æ²¡æ˜¾ç¤ºè¯¾ç¨‹ä¸”æ˜¾ç¤ºä¸å…¨ï¼Œç»è¿‡åˆ†æå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š

**æ ¹æœ¬åŸå› ï¼š**
1. **å‘¨æ¬¡è®¡ç®—é”™è¯¯**ï¼šä»£ç å‡è®¾å­¦æœŸä»9æœˆå¼€å§‹ï¼Œä½†å½“å‰æ˜¯6æœˆ
2. **ç¼ºå°‘è°ƒè¯•ä¿¡æ¯**ï¼šæ— æ³•ç¡®å®šæ•°æ®è·å–å’Œè¿‡æ»¤é€»è¾‘æ˜¯å¦æ­£å¸¸
3. **ç©ºçŠ¶æ€å¤„ç†ä¸è¶³**ï¼šæ²¡æœ‰è¯¾ç¨‹æ—¶ç¼ºå°‘å‹å¥½æç¤º
4. **æµ‹è¯•æ•°æ®ç¼ºå¤±**ï¼šæ²¡æœ‰ä¾¿æ·çš„æ–¹å¼æ·»åŠ æµ‹è¯•è¯¾ç¨‹

#### 25.2 ä¿®å¤æ–¹æ¡ˆ

**1. æ™ºèƒ½å‘¨æ¬¡è®¡ç®—ï¼š**
```javascript
function getCurrentWeek(): number {
  const now = currentTime.value;
  const currentYear = now.getFullYear();

  // æ ¹æ®æœˆä»½æ™ºèƒ½é€‰æ‹©å­¦æœŸå¼€å§‹æ—¶é—´
  let semesterStart: Date;
  if (now.getMonth() >= 1 && now.getMonth() <= 6) { // 2-7æœˆ
    semesterStart = new Date(currentYear, 1, 1); // æ˜¥å­£å­¦æœŸï¼š2æœˆ1æ—¥
  } else { // 8-12æœˆæˆ–1æœˆ
    if (now.getMonth() === 0) { // 1æœˆï¼Œä½¿ç”¨å»å¹´9æœˆ
      semesterStart = new Date(currentYear - 1, 8, 1);
    } else { // 8-12æœˆ
      semesterStart = new Date(currentYear, 8, 1); // ç§‹å­£å­¦æœŸï¼š9æœˆ1æ—¥
    }
  }

  const diffTime = now.getTime() - semesterStart.getTime();
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  return Math.max(1, Math.ceil(diffDays / 7));
}
```

**2. æ·»åŠ è°ƒè¯•æ—¥å¿—ï¼š**
```javascript
const weekCourses = computed(() => {
  const week = currentWeek.value;
  console.log('å½“å‰å‘¨æ¬¡:', week);
  console.log('æ‰€æœ‰è¯¾ç¨‹:', scheduleStore.courses);
  const filtered = scheduleStore.courses.filter(course => course.weeks.includes(week));
  console.log('æœ¬å‘¨è¯¾ç¨‹:', filtered);
  return filtered;
});
```

**3. ç©ºçŠ¶æ€æ˜¾ç¤ºï¼š**
```vue
<!-- æ— è¯¾ç¨‹æ•°æ® -->
<div v-if="scheduleStore.courses.length === 0" class="empty-state">
  <div class="empty-icon">ğŸ“…</div>
  <h3>æš‚æ— è¯¾ç¨‹æ•°æ®</h3>
  <p>è¯·å‰å¾€è®¾ç½®é¡µé¢æ·»åŠ è¯¾ç¨‹æˆ–å¯¼å…¥è¯¾ç¨‹è¡¨</p>
  <el-button type="primary" @click="$emit('switch-to-settings')">
    å‰å¾€è®¾ç½®
  </el-button>
</div>

<!-- æœ¬å‘¨æ— è¯¾ç¨‹ -->
<div v-else-if="weekCourses.length === 0" class="empty-state">
  <div class="empty-icon">ğŸ‰</div>
  <h3>æœ¬å‘¨æ— è¯¾ç¨‹å®‰æ’</h3>
  <p>ç¬¬ {{ currentWeek }} å‘¨æ²¡æœ‰è¯¾ç¨‹ï¼Œå¥½å¥½ä¼‘æ¯å§ï¼</p>
</div>
```

**4. æµ‹è¯•æ•°æ®åŠŸèƒ½ï¼š**
```javascript
async function addTestData() {
  const testCourses = [
    {
      name: 'é«˜ç­‰æ•°å­¦',
      teacher: 'å¼ æ•™æˆ',
      location: 'æ•™å­¦æ¥¼A101',
      weekday: 1, // å‘¨ä¸€
      start_time: '08:00:00',
      end_time: '09:40:00',
      weeks: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
      color: '#409EFF'
    },
    // ... æ›´å¤šæµ‹è¯•è¯¾ç¨‹
  ];

  for (const courseData of testCourses) {
    await scheduleStore.createCourse(courseData);
  }
}
```

#### 25.3 ä¿®å¤æ•ˆæœ
- âœ… **æ™ºèƒ½å‘¨æ¬¡è®¡ç®—**ï¼šæ ¹æ®å½“å‰æœˆä»½è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„å­¦æœŸå¼€å§‹æ—¶é—´
- âœ… **è°ƒè¯•ä¿¡æ¯å®Œæ•´**ï¼šå¯ä»¥æ¸…æ¥šçœ‹åˆ°æ•°æ®è·å–å’Œè¿‡æ»¤è¿‡ç¨‹
- âœ… **å‹å¥½ç©ºçŠ¶æ€**ï¼šæ— è¯¾ç¨‹æ—¶æä¾›æ˜ç¡®æŒ‡å¼•å’Œæ“ä½œæŒ‰é’®
- âœ… **ä¾¿æ·æµ‹è¯•**ï¼šä¸€é”®æ·»åŠ 5é—¨æµ‹è¯•è¯¾ç¨‹ï¼Œè¦†ç›–å‘¨ä¸€åˆ°å‘¨äº”
- âœ… **ç”¨æˆ·ä½“éªŒ**ï¼šä»"å®Œå…¨ç©ºç™½"åˆ°"æ¸…æ™°å¯ç”¨"çš„æ˜¾è‘—æ”¹å–„

#### 25.4 æŠ€æœ¯ç»†èŠ‚
- **å­¦æœŸé€‚é…**ï¼šæ”¯æŒæ˜¥å­£å­¦æœŸï¼ˆ2-7æœˆï¼‰å’Œç§‹å­£å­¦æœŸï¼ˆ8-1æœˆï¼‰
- **å®¹é”™å¤„ç†**ï¼šå‘¨æ¬¡è®¡ç®—æœ€å°å€¼ä¸º1ï¼Œé¿å…è´Ÿæ•°æˆ–0
- **è§†è§‰è®¾è®¡**ï¼šç©ºçŠ¶æ€ä½¿ç”¨å¤§å›¾æ ‡å’Œæ¸…æ™°çš„æ–‡å­—è¯´æ˜
- **æ•°æ®å®Œæ•´æ€§**ï¼šæµ‹è¯•è¯¾ç¨‹åŒ…å«æ‰€æœ‰å¿…è¦å­—æ®µå’Œåˆç†çš„æ—¶é—´å®‰æ’

#### 25.5 æ˜¾ç¤ºä¸å…¨é—®é¢˜ä¿®å¤
ç”¨æˆ·åé¦ˆè¯¾ç¨‹è¡¨æ˜¾ç¤ºä¸å…¨ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–äº†å¸ƒå±€ï¼š

**é—®é¢˜åˆ†æï¼š**
- å›ºå®šé«˜åº¦è®¡ç®—ä¸å‡†ç¡®ï¼Œå¯¼è‡´å†…å®¹è¢«æˆªæ–­
- ç¼ºå°‘å“åº”å¼è®¾è®¡ï¼Œä¸åŒçª—å£å¤§å°ä¸‹è¡¨ç°ä¸ä¸€è‡´
- å¼¹æ€§å¸ƒå±€ä¸å®Œæ•´ï¼Œå®¹å™¨é«˜åº¦æº¢å‡º

**è§£å†³æ–¹æ¡ˆï¼š**
```css
/* ä¸»å®¹å™¨ä¼˜åŒ– */
.app-main {
  max-width: 1400px;  /* å¢åŠ æœ€å¤§å®½åº¦ */
  min-height: 0;      /* å…è®¸å¼¹æ€§æ”¶ç¼© */
}

/* ä¸€å‘¨è§†å›¾é«˜åº¦ä¼˜åŒ– */
.weekly-schedule {
  min-height: 500px;                /* ä¿è¯æœ€å°å¯ç”¨é«˜åº¦ */
  max-height: calc(100vh - 200px);  /* åŠ¨æ€æœ€å¤§é«˜åº¦ */
}

/* å“åº”å¼è®¾è®¡ */
@media (max-height: 700px) {
  .time-slot, .course-slot { height: 50px; }
  .day-header, .time-header { height: 60px; }
}

@media (max-height: 600px) {
  .time-slot, .course-slot { height: 40px; }
}
```

**ä¿®å¤æ•ˆæœï¼š**
- âœ… **å®Œæ•´æ˜¾ç¤º**ï¼šè¯¾ç¨‹è¡¨åœ¨ä»»ä½•çª—å£å¤§å°ä¸‹éƒ½èƒ½å®Œæ•´æ˜¾ç¤º
- âœ… **å“åº”å¼é€‚é…**ï¼šæ ¹æ®çª—å£é«˜åº¦è‡ªåŠ¨è°ƒæ•´è¡Œé«˜
- âœ… **æ»šåŠ¨ä¼˜åŒ–**ï¼šå†…å®¹è¿‡å¤šæ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡è€Œä¸æ˜¯æˆªæ–­
- âœ… **å¸ƒå±€ç¨³å®š**ï¼šå¼¹æ€§å¸ƒå±€ç¡®ä¿å„éƒ¨åˆ†æ¯”ä¾‹åè°ƒ

#### 25.6 ç»Ÿä¸€æ»šåŠ¨ä½“éªŒä¼˜åŒ–
ç”¨æˆ·åé¦ˆæ—¶é—´è½´ä¸è·Ÿç€æ»šåŠ¨ï¼Œæ¯å¤©éƒ½æœ‰ç‹¬ç«‹æ»šåŠ¨æ¡çš„é—®é¢˜ï¼Œé‡æ–°è®¾è®¡äº†å¸ƒå±€ç»“æ„ï¼š

**é—®é¢˜åˆ†æï¼š**
- æ—¶é—´è½´å’Œè¯¾ç¨‹å†…å®¹åˆ†ç¦»ï¼Œæ»šåŠ¨ä¸åŒæ­¥
- æ¯ä¸ªå¤©åˆ—éƒ½æœ‰ç‹¬ç«‹æ»šåŠ¨æ¡ï¼Œä½“éªŒæ··ä¹±
- ç¼ºå°‘ç»Ÿä¸€çš„æ»šåŠ¨åŒºåŸŸ

**é‡æ–°è®¾è®¡æ–¹æ¡ˆï¼š**
```vue
<!-- æ–°çš„å¸ƒå±€ç»“æ„ -->
<div class="weekly-schedule">
  <!-- å›ºå®šå¤´éƒ¨ï¼šæ—¶é—´æ ‡é¢˜ + æ˜ŸæœŸæ ‡é¢˜ -->
  <div class="schedule-header-row">
    <div class="time-header">æ—¶é—´</div>
    <div class="day-header">å‘¨ä¸€</div>
    <!-- ... å…¶ä»–å¤© -->
  </div>

  <!-- ç»Ÿä¸€æ»šåŠ¨åŒºåŸŸï¼šæ—¶é—´è½´ + æ‰€æœ‰è¯¾ç¨‹å†…å®¹ -->
  <div class="schedule-content">
    <div class="schedule-grid">
      <div class="time-column">æ—¶é—´è½´</div>
      <div class="day-content-column">è¯¾ç¨‹å†…å®¹</div>
      <!-- ... å…¶ä»–å¤© -->
    </div>
  </div>
</div>
```

**CSS å¸ƒå±€ä¼˜åŒ–ï¼š**
```css
.weekly-schedule {
  display: flex;
  flex-direction: column;  /* å‚ç›´å¸ƒå±€ï¼šå¤´éƒ¨ + å†…å®¹ */
}

.schedule-header-row {
  flex-shrink: 0;  /* å›ºå®šå¤´éƒ¨ä¸æ»šåŠ¨ */
}

.schedule-content {
  flex: 1;
  overflow-y: auto;  /* ç»Ÿä¸€æ»šåŠ¨åŒºåŸŸ */
}

.schedule-grid {
  display: flex;  /* æ°´å¹³å¸ƒå±€ï¼šæ—¶é—´è½´ + å¤©åˆ— */
}
```

**ä¿®å¤æ•ˆæœï¼š**
- âœ… **åŒæ­¥æ»šåŠ¨**ï¼šæ—¶é—´è½´å’Œè¯¾ç¨‹å†…å®¹å®Œå…¨åŒæ­¥æ»šåŠ¨
- âœ… **ç»Ÿä¸€ä½“éªŒ**ï¼šåªæœ‰ä¸€ä¸ªæ»šåŠ¨æ¡ï¼Œæ“ä½œç®€å•ç›´è§‚
- âœ… **å›ºå®šå¤´éƒ¨**ï¼šæ˜ŸæœŸæ ‡é¢˜å§‹ç»ˆå¯è§ï¼Œä¸ä¼šæ»šåŠ¨æ¶ˆå¤±
- âœ… **å¸ƒå±€æ¸…æ™°**ï¼šæ—¶é—´å’Œè¯¾ç¨‹å¯¹åº”å…³ç³»ä¸€ç›®äº†ç„¶

### 26. æ·±è‰²æ¨¡å¼åŠŸèƒ½å®ç° (2025-06-16)

#### 26.1 åŠŸèƒ½éœ€æ±‚
ç”¨æˆ·è¦æ±‚æ·»åŠ æ·±è‰²æ¨¡å¼åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- æ‰‹åŠ¨åˆ‡æ¢æ·±è‰²/æµ…è‰²æ¨¡å¼
- æ ¹æ®ç³»ç»Ÿä¸»é¢˜è‡ªåŠ¨åˆ‡æ¢
- å…¨åº”ç”¨ç»Ÿä¸€çš„ä¸»é¢˜ç®¡ç†

#### 26.2 æŠ€æœ¯æ¶æ„

**1. ä¸»é¢˜ç®¡ç†Store:**
```typescript
// src/stores/themeStore.ts
export type ThemeMode = 'light' | 'dark' | 'auto';

class ThemeStore {
  setMode(mode: ThemeMode)     // è®¾ç½®ä¸»é¢˜æ¨¡å¼
  toggleDark()                 // åˆ‡æ¢æ·±è‰²æ¨¡å¼
  setupSystemThemeListener()   // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
  init()                      // åˆå§‹åŒ–ä¸»é¢˜ç³»ç»Ÿ
}
```

**2. ä¸»é¢˜åˆ‡æ¢é€»è¾‘:**
- **è‡ªåŠ¨æ¨¡å¼**: ç›‘å¬ `prefers-color-scheme` åª’ä½“æŸ¥è¯¢
- **æ‰‹åŠ¨æ¨¡å¼**: ç”¨æˆ·ä¸»åŠ¨é€‰æ‹© light/dark
- **æ™ºèƒ½åˆ‡æ¢**: ä»è‡ªåŠ¨æ¨¡å¼åˆ‡æ¢åˆ°æ‰‹åŠ¨æ¨¡å¼çš„å¹³æ»‘è¿‡æ¸¡

**3. DOMåº”ç”¨æœºåˆ¶:**
```typescript
private applyTheme(isDark: boolean) {
  const html = document.documentElement;

  if (isDark) {
    html.classList.add('dark');
    html.setAttribute('data-theme', 'dark');
  } else {
    html.classList.remove('dark');
    html.setAttribute('data-theme', 'light');
  }
}
```

#### 26.3 UIé›†æˆ

**1. ä¸»é¢˜åˆ‡æ¢æŒ‰é’®:**
```vue
<el-button
  type="primary"
  size="large"
  @click="toggleTheme"
  :icon="getThemeIcon()"
  circle
  :title="getThemeTooltip()"
/>
```

**2. åŠ¨æ€å›¾æ ‡æ˜¾ç¤º:**
- ğŸŒ æµ…è‰²æ¨¡å¼ (Sunny)
- ğŸŒ™ æ·±è‰²æ¨¡å¼ (Moon)
- ğŸ–¥ï¸ è‡ªåŠ¨æ¨¡å¼ (Monitor)

**3. æ™ºèƒ½æç¤ºæ–‡å­—:**
- "æµ…è‰²æ¨¡å¼" / "æ·±è‰²æ¨¡å¼" / "è‡ªåŠ¨æ¨¡å¼ (å½“å‰: æ·±è‰²)"

#### 26.4 æ ·å¼ç³»ç»Ÿ

**1. CSSå˜é‡ç³»ç»Ÿ:**
```css
:root {
  --bg-primary: #ffffff;
  --text-primary: #2c3e50;
  --border-primary: #e1e8ed;
}

.dark {
  --bg-primary: #1a1a1a;
  --text-primary: #e5eaf3;
  --border-primary: #4c4d4f;
}
```

**2. ç»„ä»¶æ·±è‰²æ¨¡å¼é€‚é…:**
- **ä¸»åº”ç”¨**: æ¸å˜èƒŒæ™¯ã€å¤´éƒ¨ã€å¡ç‰‡
- **è¯¾ç¨‹è¡¨**: è¡¨æ ¼ã€æ—¶é—´è½´ã€è¯¾ç¨‹å¡ç‰‡
- **è®¾ç½®é¢æ¿**: è¡¨å•ã€è¡¨æ ¼ã€å¯¹è¯æ¡†
- **æ¡Œé¢å°ç»„ä»¶**: èƒŒæ™¯ã€æ–‡å­—ã€è¯¾ç¨‹è¡Œ

**3. Element Plusæ·±è‰²æ¨¡å¼:**
```css
.dark .el-button {
  --el-button-bg-color: var(--bg-secondary);
  --el-button-text-color: var(--text-primary);
}
```

#### 26.5 æŒä¹…åŒ–å­˜å‚¨

**1. æœ¬åœ°å­˜å‚¨:**
```typescript
// ä¿å­˜ç”¨æˆ·é€‰æ‹©
localStorage.setItem('theme-mode', mode);

// åº”ç”¨å¯åŠ¨æ—¶æ¢å¤
loadFromStorage() {
  const stored = localStorage.getItem('theme-mode');
  if (stored && ['light', 'dark', 'auto'].includes(stored)) {
    state.mode = stored as ThemeMode;
  }
}
```

**2. è·¨çª—å£åŒæ­¥:**
- ä¸»åº”ç”¨å’Œæ¡Œé¢å°ç»„ä»¶å…±äº«ä¸»é¢˜çŠ¶æ€
- ç³»ç»Ÿä¸»é¢˜å˜åŒ–æ—¶è‡ªåŠ¨åŒæ­¥

#### 26.6 ç”¨æˆ·ä½“éªŒä¼˜åŒ–

**1. å¹³æ»‘è¿‡æ¸¡:**
```css
* {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}
```

**2. æ™ºèƒ½åé¦ˆ:**
- åˆ‡æ¢æ—¶æ˜¾ç¤ºæ¶ˆæ¯æç¤ºï¼š"å·²åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼"
- å›¾æ ‡å’Œæç¤ºæ–‡å­—å®æ—¶æ›´æ–°
- è‡ªåŠ¨æ¨¡å¼æ˜¾ç¤ºå½“å‰å®é™…ä¸»é¢˜

**3. ç³»ç»Ÿé›†æˆ:**
- ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–äº‹ä»¶
- è‡ªåŠ¨æ¨¡å¼ä¸‹è·Ÿéšç³»ç»Ÿè®¾ç½®
- å…¼å®¹æ–°æ—§æµè§ˆå™¨API

#### 26.7 å®ç°æ•ˆæœ

- âœ… **ä¸‰ç§æ¨¡å¼**: æµ…è‰²ã€æ·±è‰²ã€è‡ªåŠ¨ï¼ˆè·Ÿéšç³»ç»Ÿï¼‰
- âœ… **æ™ºèƒ½åˆ‡æ¢**: åœ†å½¢æŒ‰é’®ä¸€é”®åˆ‡æ¢ï¼Œå›¾æ ‡åŠ¨æ€æ˜¾ç¤º
- âœ… **å…¨å±€é€‚é…**: æ‰€æœ‰ç»„ä»¶å’ŒElement Plusç»„ä»¶å®Œæ•´æ”¯æŒ
- âœ… **æŒä¹…åŒ–**: ç”¨æˆ·é€‰æ‹©æ°¸ä¹…ä¿å­˜ï¼Œé‡å¯åæ¢å¤
- âœ… **ç³»ç»ŸåŒæ­¥**: è‡ªåŠ¨æ¨¡å¼ä¸‹è·Ÿéšç³»ç»Ÿä¸»é¢˜å˜åŒ–
- âœ… **å¹³æ»‘è¿‡æ¸¡**: 0.3sè¿‡æ¸¡åŠ¨ç”»ï¼Œè§†è§‰ä½“éªŒæµç•…
- âœ… **è·¨çª—å£**: ä¸»åº”ç”¨å’Œæ¡Œé¢å°ç»„ä»¶ä¸»é¢˜åŒæ­¥

### 27. æ¡Œé¢å°ç»„ä»¶æŒ‰é’®åŠŸèƒ½ä¿®å¤ (2025-06-16)

#### 27.1 é—®é¢˜å‘ç°
ç”¨æˆ·åé¦ˆä¸»å±å¹•ä¸Šçš„"æ˜¾ç¤ºæ¡Œé¢å°ç»„ä»¶"æŒ‰é’®æ— æ³•ä½¿ç”¨ï¼Œç‚¹å‡»åæ²¡æœ‰ä»»ä½•ååº”ã€‚

**é—®é¢˜åˆ†æï¼š**
é€šè¿‡ä»£ç æ£€æŸ¥å‘ç°ï¼Œå‰ç«¯ `App.vue` ä¸­çš„ `toggleWidget()` å‡½æ•°è°ƒç”¨äº† `invoke<boolean>('toggle_widget')` å‘½ä»¤ï¼Œä½†åç«¯ `lib.rs` ä¸­ç¼ºå°‘å¯¹åº”çš„ Tauri å‘½ä»¤å®ç°ã€‚

#### 27.2 ç¼ºå¤±çš„å‘½ä»¤
å‰ç«¯æœŸæœ›çš„å‘½ä»¤ï¼š
- `toggle_widget`: åˆ‡æ¢å°ç»„ä»¶æ˜¾ç¤º/éšè—çŠ¶æ€
- `show_widget`: æ˜¾ç¤ºå°ç»„ä»¶
- `hide_widget`: éšè—å°ç»„ä»¶

#### 27.3 ä¿®å¤å®ç°

**1. æ·»åŠ ç¼ºå¤±çš„ Tauri å‘½ä»¤ï¼š**
```rust
// æ˜¾ç¤ºæ¡Œé¢å°ç»„ä»¶
#[tauri::command]
fn show_widget(app: tauri::AppHandle) -> Result<(), String> {
    info!("show_widget è¢«è°ƒç”¨");

    if let Some(widget_window) = app.get_webview_window("widget") {
        widget_window.show().map_err(|e| e.to_string())?;
        // é‡æ–°è®¾ç½®æ¡Œé¢æ¨¡å¼
        let _ = set_desktop_widget_mode(app);
    } else {
        return Err("æœªæ‰¾åˆ°å°ç»„ä»¶çª—å£".to_string());
    }
    Ok(())
}

// éšè—æ¡Œé¢å°ç»„ä»¶
#[tauri::command]
fn hide_widget(app: tauri::AppHandle) -> Result<(), String> {
    info!("hide_widget è¢«è°ƒç”¨");

    if let Some(widget_window) = app.get_webview_window("widget") {
        widget_window.hide().map_err(|e| e.to_string())?;
    } else {
        return Err("æœªæ‰¾åˆ°å°ç»„ä»¶çª—å£".to_string());
    }
    Ok(())
}

// åˆ‡æ¢æ¡Œé¢å°ç»„ä»¶æ˜¾ç¤ºçŠ¶æ€
#[tauri::command]
fn toggle_widget(app: tauri::AppHandle) -> Result<bool, String> {
    info!("toggle_widget è¢«è°ƒç”¨");

    if let Some(widget_window) = app.get_webview_window("widget") {
        let is_visible = widget_window.is_visible().map_err(|e| e.to_string())?;

        if is_visible {
            hide_widget(app)?;
            Ok(false)
        } else {
            show_widget(app)?;
            Ok(true)
        }
    } else {
        Err("æœªæ‰¾åˆ°å°ç»„ä»¶çª—å£".to_string())
    }
}
```

**2. æ³¨å†Œå‘½ä»¤åˆ° invoke_handlerï¼š**
```rust
.invoke_handler(tauri::generate_handler![
    greet,
    show_main_app,
    set_desktop_widget_mode,
    save_widget_position,
    restore_widget_position,
    get_window_position,
    show_widget,        // æ–°å¢
    hide_widget,        // æ–°å¢
    toggle_widget       // æ–°å¢
])
```

#### 27.4 åŠŸèƒ½ç‰¹æ€§

**1. æ™ºèƒ½çŠ¶æ€æ£€æµ‹ï¼š**
- æ£€æŸ¥å°ç»„ä»¶çª—å£å½“å‰å¯è§æ€§
- æ ¹æ®çŠ¶æ€å†³å®šæ˜¾ç¤ºæˆ–éšè—æ“ä½œ

**2. é”™è¯¯å¤„ç†ï¼š**
- å®Œæ•´çš„é”™è¯¯æ—¥å¿—è®°å½•
- å‹å¥½çš„é”™è¯¯ä¿¡æ¯è¿”å›
- çª—å£ä¸å­˜åœ¨æ—¶çš„å®¹é”™å¤„ç†

**3. æ¡Œé¢æ¨¡å¼ä¿æŒï¼š**
- æ˜¾ç¤ºå°ç»„ä»¶æ—¶é‡æ–°è®¾ç½®æ¡Œé¢æ¨¡å¼
- ç¡®ä¿å°ç»„ä»¶ä¿æŒæ­£ç¡®çš„å±‚çº§å…³ç³»

**4. çŠ¶æ€åŒæ­¥ï¼š**
- è¿”å›å¸ƒå°”å€¼è¡¨ç¤ºå½“å‰æ˜¾ç¤ºçŠ¶æ€
- å‰ç«¯æŒ‰é’®æ–‡å­—å’Œå›¾æ ‡å®æ—¶æ›´æ–°

#### 27.5 ä¿®å¤æ•ˆæœ
- âœ… **æŒ‰é’®å¯ç”¨**: "æ˜¾ç¤ºæ¡Œé¢å°ç»„ä»¶"æŒ‰é’®ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œ
- âœ… **çŠ¶æ€åˆ‡æ¢**: å¯ä»¥åœ¨æ˜¾ç¤ºå’Œéšè—ä¹‹é—´æ­£ç¡®åˆ‡æ¢
- âœ… **è§†è§‰åé¦ˆ**: æŒ‰é’®æ–‡å­—å’Œå›¾æ ‡æ ¹æ®çŠ¶æ€å®æ—¶æ›´æ–°
- âœ… **é”™è¯¯å¤„ç†**: æ“ä½œå¤±è´¥æ—¶æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
- âœ… **æ—¥å¿—è®°å½•**: å®Œæ•´çš„æ“ä½œæ—¥å¿—ä¾¿äºè°ƒè¯•
- âœ… **æ¡Œé¢é›†æˆ**: æ˜¾ç¤ºæ—¶ä¿æŒæ­£ç¡®çš„æ¡Œé¢å°ç»„ä»¶è¡Œä¸º

### 28. å‰ç«¯å…¬å…±å‡½æ•°æŠ½è±¡é‡æ„ (2025-06-16)

#### 28.1 é‡æ„ç›®æ ‡
å°†å‰ç«¯ç»„ä»¶ä¸­é‡å¤çš„å·¥å…·å‡½æ•°æŠ½è±¡åˆ°ç»Ÿä¸€çš„å·¥å…·åº“ä¸­ï¼Œæé«˜ä»£ç å¤ç”¨æ€§å’Œç»´æŠ¤æ€§ã€‚

**é‡å¤å‡½æ•°è¯†åˆ«ï¼š**
- æ—¶é—´ç›¸å…³ï¼š`getCurrentWeek`, `formatTime`, `formatCurrentTime`
- è¯¾ç¨‹çŠ¶æ€ï¼š`isCurrentCourse`, `isPastCourse`, `isUpcomingCourse`
- æ—¥æœŸç›¸å…³ï¼š`isToday`, `formatDate`, `isCurrentTimeSlot`
- å·¥å…·å‡½æ•°ï¼š`getWeekdayName`, `getCourseDuration`, `getCoursesForDayAndTime`

#### 28.2 æ¶æ„è®¾è®¡

**1. ç±»å‹å®šä¹‰ç»Ÿä¸€ (`src/types/course.ts`)ï¼š**
```typescript
export interface Course {
  id: string;
  name: string;
  teacher?: string;
  location?: string;
  weekday: number; // 1=å‘¨ä¸€, 2=å‘¨äºŒ, ..., 7=å‘¨æ—¥
  start_time: string; // "HH:MM:SS" æ ¼å¼
  end_time: string; // "HH:MM:SS" æ ¼å¼
  weeks: number[]; // ç¬¬å‡ å‘¨çš„æ•°ç»„
  color?: string; // è¯¾ç¨‹é¢œè‰²
}

export enum CourseStatus {
  PAST = 'past',        // å·²ç»“æŸ
  CURRENT = 'current',  // æ­£åœ¨è¿›è¡Œ
  UPCOMING = 'upcoming', // å³å°†å¼€å§‹
  FUTURE = 'future'     // æœªæ¥è¯¾ç¨‹
}

export type ThemeMode = 'light' | 'dark' | 'auto';
```

**2. å·¥å…·å‡½æ•°åº“ (`src/utils/courseUtils.ts`)ï¼š**
```typescript
// æ™ºèƒ½å­¦æœŸå‘¨æ¬¡è®¡ç®—
export function getCurrentWeek(currentTime: Date = new Date()): number

// æ—¶é—´æ ¼å¼åŒ–
export function formatTime(timeStr: string): string
export function formatCurrentTime(date: Date): string

// è¯¾ç¨‹çŠ¶æ€åˆ¤æ–­
export function isCurrentCourse(course: Course, currentTime: Date): boolean
export function isPastCourse(course: Course, currentTime: Date): boolean
export function isUpcomingCourse(course: Course, currentTime: Date): boolean
export function getCourseStatus(course: Course, currentTime: Date): CourseStatus

// æ—¥æœŸå·¥å…·
export function isToday(dayIndex: number, currentTime: Date): boolean
export function formatDate(dayIndex: number, currentTime: Date): string

// è¯¾ç¨‹å·¥å…·
export function getCourseDuration(course: Course): number
export function getCoursesForDayAndTime(courses: Course[], dayIndex: number, timeSlot: string): Course[]
export function getCurrentWeekCourses(courses: Course[], currentTime: Date): Course[]
export function getTodayCourses(courses: Course[], currentTime: Date): Course[]
```

**3. å¸¸é‡é…ç½® (`src/constants/schedule.ts`)ï¼š**
```typescript
export const WEEKDAY_NAMES = ['', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
export const WEEK_DAYS = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
export const TIME_SLOTS = ['08:00', '09:00', ..., '22:00'];
export const DEFAULT_COURSE_COLORS = ['#3498db', '#e74c3c', ...];
export const STATUS_COLORS = {
  CURRENT: '#27ae60',   // ç»¿è‰² - æ­£åœ¨è¿›è¡Œ
  PAST: '#95a5a6',      // ç°è‰² - å·²ç»“æŸ
  UPCOMING: '#f39c12',  // æ©™è‰² - å³å°†å¼€å§‹
  FUTURE: '#3498db'     // è“è‰² - æœªæ¥è¯¾ç¨‹
};
```

#### 28.3 ç»„ä»¶é‡æ„

**1. DesktopScheduleWidget.vue é‡æ„ï¼š**
- ç§»é™¤é‡å¤çš„å‡½æ•°å®šä¹‰
- å¯¼å…¥ç»Ÿä¸€çš„å·¥å…·å‡½æ•°å’Œç±»å‹
- ä½¿ç”¨åŒ…è£…å‡½æ•°ä¼ é€’å½“å‰æ—¶é—´å‚æ•°
- ç®€åŒ– `todayCourses` è®¡ç®—é€»è¾‘

**2. ScheduleDisplay.vue é‡æ„ï¼š**
- æ›¿æ¢æ‰€æœ‰é‡å¤å‡½æ•°ä¸ºå·¥å…·åº“å‡½æ•°
- ä½¿ç”¨å¸¸é‡é…ç½®æ›¿ä»£ç¡¬ç¼–ç æ•°ç»„
- ä¼˜åŒ–å‘¨æ¬¡å’Œè¯¾ç¨‹è¿‡æ»¤é€»è¾‘
- ç»Ÿä¸€å‡½æ•°å‘½åå’Œå‚æ•°ä¼ é€’

**3. SettingsPanel.vue é‡æ„ï¼š**
- å¯¼å…¥ `getWeekdayName` å’Œ `formatTime` å‡½æ•°
- ç§»é™¤é‡å¤çš„å‡½æ•°å®šä¹‰
- ä¿æŒç°æœ‰åŠŸèƒ½ä¸å˜

#### 28.4 æŠ€æœ¯ä¼˜åŠ¿

**1. ä»£ç å¤ç”¨ï¼š**
- æ¶ˆé™¤äº† 3 ä¸ªç»„ä»¶ä¸­çš„é‡å¤å‡½æ•°
- ç»Ÿä¸€çš„å‡½æ•°å®ç°ç¡®ä¿è¡Œä¸ºä¸€è‡´
- å‡å°‘ä»£ç é‡çº¦ 200+ è¡Œ

**2. ç»´æŠ¤æ€§æå‡ï¼š**
- å•ä¸€èŒè´£ï¼šæ¯ä¸ªå‡½æ•°åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- é›†ä¸­ç®¡ç†ï¼šæ‰€æœ‰å·¥å…·å‡½æ•°åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­
- ç±»å‹å®‰å…¨ï¼šä½¿ç”¨ TypeScript ä¸¥æ ¼ç±»å‹æ£€æŸ¥

**3. æ‰©å±•æ€§å¢å¼ºï¼š**
- æ–°å¢åŠŸèƒ½åªéœ€åœ¨å·¥å…·åº“ä¸­æ·»åŠ 
- å¸¸é‡é…ç½®ä¾¿äºè‡ªå®šä¹‰å’Œæ‰©å±•
- æ¨¡å—åŒ–è®¾è®¡æ”¯æŒæŒ‰éœ€å¯¼å…¥

**4. æµ‹è¯•å‹å¥½ï¼š**
- çº¯å‡½æ•°è®¾è®¡ï¼Œæ˜“äºå•å…ƒæµ‹è¯•
- å‚æ•°åŒ–æ—¶é—´ï¼Œä¾¿äºæµ‹è¯•ä¸åŒåœºæ™¯
- æ¸…æ™°çš„è¾“å…¥è¾“å‡ºï¼Œä¾¿äºéªŒè¯

#### 28.5 æ™ºèƒ½å‘¨æ¬¡è®¡ç®—ä¼˜åŒ–

**ç»Ÿä¸€çš„å­¦æœŸè®¡ç®—é€»è¾‘ï¼š**
```typescript
function getCurrentWeek(currentTime: Date = new Date()): number {
  const now = currentTime;
  const currentYear = now.getFullYear();

  // æ ¹æ®æœˆä»½æ™ºèƒ½é€‰æ‹©å­¦æœŸå¼€å§‹æ—¶é—´
  let semesterStart: Date;
  if (now.getMonth() >= 1 && now.getMonth() <= 6) { // 2-7æœˆ
    semesterStart = new Date(currentYear, SEMESTER_CONFIG.SPRING.startMonth, SEMESTER_CONFIG.SPRING.startDay);
  } else { // 8-12æœˆæˆ–1æœˆ
    if (now.getMonth() === 0) { // 1æœˆï¼Œä½¿ç”¨å»å¹´9æœˆ
      semesterStart = new Date(currentYear - 1, SEMESTER_CONFIG.AUTUMN.startMonth, SEMESTER_CONFIG.AUTUMN.startDay);
    } else { // 8-12æœˆ
      semesterStart = new Date(currentYear, SEMESTER_CONFIG.AUTUMN.startMonth, SEMESTER_CONFIG.AUTUMN.startDay);
    }
  }

  const diffTime = now.getTime() - semesterStart.getTime();
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
  return Math.max(1, Math.ceil(diffDays / 7));
}
```

#### 28.6 é‡æ„æ•ˆæœ

- âœ… **ä»£ç å¤ç”¨**: æ¶ˆé™¤äº†æ‰€æœ‰é‡å¤çš„å·¥å…·å‡½æ•°
- âœ… **ç±»å‹å®‰å…¨**: ç»Ÿä¸€çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… **ç»´æŠ¤æ€§**: é›†ä¸­ç®¡ç†ï¼Œå•ä¸€ä¿®æ”¹ç‚¹
- âœ… **æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºåŠŸèƒ½æ‰©å±•
- âœ… **ä¸€è‡´æ€§**: æ‰€æœ‰ç»„ä»¶ä½¿ç”¨ç›¸åŒçš„è®¡ç®—é€»è¾‘
- âœ… **å¯æµ‹è¯•**: çº¯å‡½æ•°è®¾è®¡ï¼Œä¾¿äºå•å…ƒæµ‹è¯•
- âœ… **é…ç½®åŒ–**: å¸¸é‡é…ç½®ä¾¿äºè‡ªå®šä¹‰
- âœ… **æ€§èƒ½ä¼˜åŒ–**: å‡å°‘é‡å¤ä»£ç ï¼Œæå‡åŠ è½½é€Ÿåº¦

### 29. é‡æ„é—®é¢˜ä¿®å¤ä¸å›æ»š (2025-06-16)

#### 29.1 é—®é¢˜å‘ç°
åœ¨è¿›è¡Œå‰ç«¯å…¬å…±å‡½æ•°æŠ½è±¡é‡æ„åï¼Œåº”ç”¨çª—å£å‡ºç°å´©æºƒé—®é¢˜ï¼Œæ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚

**é—®é¢˜åˆ†æï¼š**
1. é‡æ„è¿‡ç¨‹ä¸­å¯èƒ½å¼•å…¥äº†å¾ªç¯ä¾èµ–
2. å¯¼å…¥è·¯å¾„æˆ–å‡½æ•°ç­¾åå¯èƒ½å­˜åœ¨é”™è¯¯
3. ç±»å‹å®šä¹‰å¯èƒ½ä¸å…¼å®¹

#### 29.2 ä¸´æ—¶å›æ»šç­–ç•¥
ä¸ºäº†å¿«é€Ÿæ¢å¤åº”ç”¨åŠŸèƒ½ï¼Œé‡‡ç”¨äº†ä¸´æ—¶å›æ»šç­–ç•¥ï¼š

**1. æ¢å¤ç»„ä»¶å†…éƒ¨å‡½æ•°å®šä¹‰ï¼š**
- `DesktopScheduleWidget.vue`: æ¢å¤å†…éƒ¨å‡½æ•°å®ç°
- `ScheduleDisplay.vue`: æ¢å¤å†…éƒ¨å‡½æ•°å®ç°
- ä¿ç•™æ¥å£å®šä¹‰ï¼Œç§»é™¤å¤–éƒ¨ä¾èµ–

**2. ä¿ç•™å·¥å…·åº“æ–‡ä»¶ï¼š**
- ä¿ç•™ `src/utils/courseUtils.ts` ä¾›åç»­ä½¿ç”¨
- ä¿ç•™ `src/types/course.ts` ç±»å‹å®šä¹‰
- ä¿ç•™ `src/constants/schedule.ts` å¸¸é‡é…ç½®

**3. ç¡®ä¿åŠŸèƒ½æ­£å¸¸ï¼š**
- æ¡Œé¢å°ç»„ä»¶æŒ‰é’®åŠŸèƒ½æ­£å¸¸
- å‘¨æ¬¡è®¡ç®—é€»è¾‘æ­£ç¡®
- è¯¾ç¨‹æ˜¾ç¤ºå’ŒçŠ¶æ€åˆ¤æ–­æ­£å¸¸

#### 29.3 åç»­ä¼˜åŒ–è®¡åˆ’
1. **æ¸è¿›å¼é‡æ„**: é€ä¸ªç»„ä»¶è¿›è¡Œé‡æ„ï¼Œé¿å…ä¸€æ¬¡æ€§å¤§è§„æ¨¡ä¿®æ”¹
2. **ä¾èµ–æ£€æŸ¥**: ä»”ç»†æ£€æŸ¥å¯¼å…¥è·¯å¾„å’Œå‡½æ•°ç­¾å
3. **æµ‹è¯•éªŒè¯**: æ¯æ¬¡ä¿®æ”¹åç«‹å³æµ‹è¯•åŠŸèƒ½
4. **é”™è¯¯å¤„ç†**: æ·»åŠ æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

#### 29.4 å½“å‰çŠ¶æ€
- âœ… **åº”ç”¨æ­£å¸¸**: ä¸»åº”ç”¨å’Œæ¡Œé¢å°ç»„ä»¶æ­£å¸¸è¿è¡Œ
- âœ… **åŠŸèƒ½å®Œæ•´**: æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… **æŒ‰é’®ä¿®å¤**: æ¡Œé¢å°ç»„ä»¶æŒ‰é’®åŠŸèƒ½æ­£å¸¸
- âœ… **å‘¨æ¬¡æ­£ç¡®**: æ™ºèƒ½å‘¨æ¬¡è®¡ç®—é€»è¾‘æ­£ç¡®
- ğŸ”„ **é‡æ„æš‚åœ**: å…¬å…±å‡½æ•°æŠ½è±¡é‡æ„æš‚æ—¶å›æ»šï¼Œå¾…åç»­ä¼˜åŒ–

### 30. TypeScript ç¼–è¯‘é”™è¯¯ä¿®å¤ (2025-06-16)

#### 30.1 é—®é¢˜å‘ç°
åœ¨å›æ»šé‡æ„åï¼Œå‘ç°åº”ç”¨ä»ç„¶æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œé€šè¿‡ `yarn build` å‘½ä»¤å‘ç°å­˜åœ¨å¤šä¸ª TypeScript ç¼–è¯‘é”™è¯¯ã€‚

**é”™è¯¯ç±»å‹ï¼š**
1. æœªä½¿ç”¨çš„å˜é‡ (`TS6133`)
2. ç±»å‹å¯¼å…¥é”™è¯¯ (`TS1361`)
3. å‡½æ•°è°ƒç”¨é”™è¯¯

#### 30.2 é”™è¯¯è¯¦æƒ…ä¸ä¿®å¤

**1. DesktopScheduleWidget.vue é”™è¯¯ï¼š**
```typescript
// é”™è¯¯ï¼šè°ƒç”¨äº†ä¸å­˜åœ¨çš„å‡½æ•°
getStatusColor(course) // âŒ

// ä¿®å¤ï¼šè°ƒç”¨æ­£ç¡®çš„åŒ…è£…å‡½æ•°
getStatusColorWrapper(course) // âœ…

// é”™è¯¯ï¼šæœªä½¿ç”¨çš„å˜é‡
const currentTimeStr = `${now.getHours()...`; // âŒ

// ä¿®å¤ï¼šç§»é™¤æœªä½¿ç”¨çš„å˜é‡
// ç›´æ¥ä½¿ç”¨éœ€è¦çš„è®¡ç®—
```

**2. ScheduleDisplay.vue é”™è¯¯ï¼š**
```typescript
// é”™è¯¯ï¼šæœªä½¿ç”¨çš„å˜é‡
v-for="(dayName, dayIndex) in weekDays" // âŒ

// ä¿®å¤ï¼šä½¿ç”¨ä¸‹åˆ’çº¿è¡¨ç¤ºæœªä½¿ç”¨
v-for="(_, dayIndex) in weekDays" // âœ…
```

**3. courseUtils.ts ç±»å‹å¯¼å…¥é”™è¯¯ï¼š**
```typescript
// é”™è¯¯ï¼šæšä¸¾ä½œä¸ºç±»å‹å¯¼å…¥
import type { Course, CourseStatus } from '../types/course'; // âŒ

// ä¿®å¤ï¼šåˆ†ç¦»ç±»å‹å’Œå€¼å¯¼å…¥
import type { Course } from '../types/course';
import { CourseStatus } from '../types/course'; // âœ…
```

#### 30.3 ä¿®å¤è¿‡ç¨‹

**æ­¥éª¤ 1ï¼š** è¿è¡Œ `yarn build` è¯†åˆ«æ‰€æœ‰ç¼–è¯‘é”™è¯¯
**æ­¥éª¤ 2ï¼š** é€ä¸€ä¿®å¤æ¯ä¸ªé”™è¯¯æ–‡ä»¶
**æ­¥éª¤ 3ï¼š** ç§»é™¤æœªä½¿ç”¨çš„å˜é‡å’Œå‚æ•°
**æ­¥éª¤ 4ï¼š** ä¿®æ­£å‡½æ•°è°ƒç”¨å’Œç±»å‹å¯¼å…¥
**æ­¥éª¤ 5ï¼š** éªŒè¯æ„å»ºæˆåŠŸ

#### 30.4 ä¿®å¤ç»“æœ

**æ„å»ºæˆåŠŸè¾“å‡ºï¼š**
```
âœ“ 1442 modules transformed.
dist/index.html                      0.64 kB â”‚ gzip:   0.35 kB
dist/widget.html                     1.10 kB â”‚ gzip:   0.55 kB
dist/assets/theme-Cbr-iXwG.css       4.72 kB â”‚ gzip:   0.93 kB
dist/assets/widget-DKhT_Nrd.css      5.80 kB â”‚ gzip:   1.58 kB
dist/assets/main-DF41RKIi.css      345.26 kB â”‚ gzip:  47.81 kB
dist/assets/widget-DdAlJ6wu.js       4.62 kB â”‚ gzip:   2.14 kB
dist/assets/theme-BgSy3-An.js       83.59 kB â”‚ gzip:  32.56 kB
dist/assets/main-CK0n67l1.js     1,023.88 kB â”‚ gzip: 321.36 kB
âœ“ built in 3.59s
```

#### 30.5 ä¿®å¤æ•ˆæœ
- âœ… **ç¼–è¯‘æˆåŠŸ**: æ‰€æœ‰ TypeScript é”™è¯¯å·²ä¿®å¤
- âœ… **ç±»å‹å®‰å…¨**: æ­£ç¡®çš„ç±»å‹å¯¼å…¥å’Œä½¿ç”¨
- âœ… **ä»£ç æ¸…æ´**: ç§»é™¤äº†æœªä½¿ç”¨çš„å˜é‡
- âœ… **å‡½æ•°è°ƒç”¨**: ä¿®æ­£äº†é”™è¯¯çš„å‡½æ•°è°ƒç”¨
- âœ… **æ„å»ºé€šè¿‡**: Vite æ„å»ºæˆåŠŸå®Œæˆ

### 31. ç³»ç»Ÿæ‰˜ç›˜åŠŸèƒ½å®ç° (2025-06-16)

#### 31.1 åŠŸèƒ½éœ€æ±‚
ç”¨æˆ·è¦æ±‚æ·»åŠ ç³»ç»Ÿæ‰˜ç›˜å°å›¾æ ‡ï¼ŒåŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š
- é€€å‡ºåº”ç”¨
- æ˜¾ç¤º/éšè—æ¡Œé¢å°ç»„ä»¶
- æ˜¾ç¤ºä¸»çª—å£

#### 31.2 å®ç°æ–¹æ¡ˆ

**1. Tauri é…ç½®æ›´æ–° (`tauri.conf.json`)ï¼š**
```json
{
  "app": {
    "trayIcon": {
      "iconPath": "icons/icon.ico",
      "iconAsTemplate": true,
      "tooltip": "è¯¾ç¨‹è¡¨ç®¡ç†ç³»ç»Ÿ"
    }
  }
}
```

**2. æƒé™é…ç½® (`capabilities/default.json`)ï¼š**
```json
{
  "permissions": [
    "core:tray:default",
    "core:menu:default",
    "core:app:allow-exit"
  ]
}
```

**3. åç«¯å®ç° (`lib.rs`)ï¼š**
```rust
// å¯¼å…¥æ‰˜ç›˜ç›¸å…³æ¨¡å—
use tauri::{Manager, menu::{MenuBuilder, MenuItem}, tray::{TrayIconBuilder, TrayIconEvent}};

// æ–°å¢é€€å‡ºå‘½ä»¤
#[tauri::command]
fn quit_app(app: tauri::AppHandle) -> Result<(), String> {
    info!("quit_app è¢«è°ƒç”¨ï¼Œå‡†å¤‡é€€å‡ºåº”ç”¨");
    app.exit(0);
    Ok(())
}

// æ‰˜ç›˜èœå•åˆ›å»º
let show_main = MenuItem::with_id(app, "show_main", "æ˜¾ç¤ºä¸»çª—å£", true, None::<&str>)?;
let toggle_widget_menu = MenuItem::with_id(app, "toggle_widget", "æ˜¾ç¤º/éšè—å°ç»„ä»¶", true, None::<&str>)?;
let quit = MenuItem::with_id(app, "quit", "é€€å‡º", true, None::<&str>)?;

// æ‰˜ç›˜å›¾æ ‡äº‹ä»¶å¤„ç†
.on_menu_event(move |app, event| {
    match event.id.as_ref() {
        "show_main" => { let _ = show_main_app(app.clone()); }
        "toggle_widget" => { let _ = toggle_widget(app.clone()); }
        "quit" => { app.exit(0); }
        _ => {}
    }
})
.on_tray_icon_event(|tray, event| {
    match event {
        TrayIconEvent::Click { button: Left, .. } => {
            // å·¦é”®ç‚¹å‡»æ˜¾ç¤ºä¸»çª—å£
            let _ = show_main_app(tray.app_handle().clone());
        }
        TrayIconEvent::DoubleClick { button: Left, .. } => {
            // åŒå‡»åˆ‡æ¢å°ç»„ä»¶
            let _ = toggle_widget(tray.app_handle().clone());
        }
        _ => {}
    }
})
```

**4. å‰ç«¯ç•Œé¢å¢å¼º (`App.vue`)ï¼š**
```typescript
// æ–°å¢é€€å‡ºåŠŸèƒ½
async function quitApp() {
  try {
    await ElMessageBox.confirm('ç¡®å®šè¦é€€å‡ºåº”ç”¨å—ï¼Ÿ', 'é€€å‡ºç¡®è®¤');
    await invoke('quit_app');
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('é€€å‡ºå¤±è´¥');
    }
  }
}
```

#### 31.3 åŠŸèƒ½ç‰¹æ€§

**1. æ‰˜ç›˜èœå•åŠŸèƒ½ï¼š**
- **æ˜¾ç¤ºä¸»çª—å£** - æ‰“å¼€è¯¾ç¨‹è¡¨ç®¡ç†ç•Œé¢
- **æ˜¾ç¤º/éšè—å°ç»„ä»¶** - åˆ‡æ¢æ¡Œé¢å°ç»„ä»¶çŠ¶æ€
- **é€€å‡º** - å®Œå…¨é€€å‡ºåº”ç”¨ç¨‹åº

**2. æ‰˜ç›˜å›¾æ ‡äº¤äº’ï¼š**
- **å·¦é”®å•å‡»** - å¿«é€Ÿæ˜¾ç¤ºä¸»çª—å£
- **åŒå‡»** - å¿«é€Ÿåˆ‡æ¢æ¡Œé¢å°ç»„ä»¶
- **å³é”®** - æ˜¾ç¤ºä¸Šä¸‹æ–‡èœå•

**3. å®‰å…¨é€€å‡ºï¼š**
- å‰ç«¯ç¡®è®¤å¯¹è¯æ¡†é˜²æ­¢è¯¯æ“ä½œ
- åç«¯æ—¥å¿—è®°å½•é€€å‡ºæ“ä½œ
- ä¼˜é›…çš„åº”ç”¨ç¨‹åºç»ˆæ­¢

**4. ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼š**
- æ‰˜ç›˜æç¤ºæ–‡å­—æ˜¾ç¤ºåº”ç”¨åç§°
- èœå•é¡¹ä½¿ç”¨ä¸­æ–‡ç•Œé¢
- æ“ä½œåé¦ˆå’Œé”™è¯¯å¤„ç†

#### 31.4 æŠ€æœ¯å®ç°

**1. Tauri v2 æ‰˜ç›˜ APIï¼š**
- ä½¿ç”¨ `TrayIconBuilder` åˆ›å»ºæ‰˜ç›˜å›¾æ ‡
- ä½¿ç”¨ `MenuBuilder` æ„å»ºä¸Šä¸‹æ–‡èœå•
- äº‹ä»¶å¤„ç†åˆ†ç¦»èœå•ç‚¹å‡»å’Œå›¾æ ‡ç‚¹å‡»

**2. æƒé™ç®¡ç†ï¼š**
- `core:tray:default` - æ‰˜ç›˜å›¾æ ‡æƒé™
- `core:menu:default` - èœå•æ“ä½œæƒé™
- `core:app:allow-exit` - åº”ç”¨é€€å‡ºæƒé™

**3. è·¨å¹³å°å…¼å®¹ï¼š**
- Windows ä½¿ç”¨ `.ico` å›¾æ ‡æ ¼å¼
- `iconAsTemplate` é€‚é…ç³»ç»Ÿä¸»é¢˜
- ç»Ÿä¸€çš„äº‹ä»¶å¤„ç†é€»è¾‘

#### 31.5 å®ç°æ•ˆæœ

- âœ… **æ‰˜ç›˜å›¾æ ‡**: ç³»ç»Ÿæ‰˜ç›˜æ˜¾ç¤ºåº”ç”¨å›¾æ ‡
- âœ… **å³é”®èœå•**: å®Œæ•´çš„åŠŸèƒ½èœå•
- âœ… **å¿«æ·æ“ä½œ**: å·¦é”®å’ŒåŒå‡»å¿«æ·æ“ä½œ
- âœ… **å®‰å…¨é€€å‡º**: ç¡®è®¤å¯¹è¯æ¡†é˜²æ­¢è¯¯æ“ä½œ
- âœ… **çŠ¶æ€åŒæ­¥**: æ‰˜ç›˜æ“ä½œä¸ä¸»ç•Œé¢çŠ¶æ€åŒæ­¥
- âœ… **ç”¨æˆ·å‹å¥½**: ä¸­æ–‡ç•Œé¢å’Œæ“ä½œæç¤º
- âœ… **åå°è¿è¡Œ**: å…³é—­ä¸»çª—å£åå¯é€šè¿‡æ‰˜ç›˜é‡æ–°æ‰“å¼€

### 32. æ‰˜ç›˜åŠŸèƒ½ç¼–è¯‘é”™è¯¯ä¿®å¤ (2025-06-16)

#### 32.1 ç¼–è¯‘é”™è¯¯
åœ¨å®ç°æ‰˜ç›˜åŠŸèƒ½åé‡åˆ°ç¼–è¯‘é”™è¯¯ï¼š

**é”™è¯¯ 1: æƒé™é…ç½®é”™è¯¯**
```
Permission core:app:allow-exit not found
```

**é”™è¯¯ 2: API è°ƒç”¨é”™è¯¯**
```
error[E0599]: no function or associated item named `separator` found for struct `tauri::menu::MenuItem`
```

#### 32.2 ä¿®å¤æ–¹æ¡ˆ

**1. æƒé™é…ç½®ä¿®å¤ï¼š**
```json
// ç§»é™¤ä¸å­˜åœ¨çš„æƒé™
"permissions": [
  "core:default",
  "opener:default",
  "core:window:allow-start-dragging",
  "core:window:allow-set-position",
  "core:window:allow-set-size",
  "core:tray:default",
  "core:menu:default"
  // ç§»é™¤: "core:app:allow-exit"
]
```

**2. é€€å‡ºæ–¹å¼ä¿®æ”¹ï¼š**
```rust
// åŸæ¥çš„æ–¹å¼ï¼ˆä¸å¯ç”¨ï¼‰
app.exit(0); // âŒ

// ä¿®å¤åçš„æ–¹å¼
std::process::exit(0); // âœ…
```

**3. èœå•åˆ†éš”ç¬¦ä¿®å¤ï¼š**
```rust
// é”™è¯¯çš„ API è°ƒç”¨
let separator = MenuItem::separator(app)?; // âŒ

// æ­£ç¡®çš„ API è°ƒç”¨
use tauri::menu::PredefinedMenuItem;
let separator = PredefinedMenuItem::separator(app)?; // âœ…
```

#### 32.3 ä¿®å¤åçš„å®Œæ•´å®ç°

**å¯¼å…¥æ¨¡å—ï¼š**
```rust
use tauri::{Manager, menu::{MenuBuilder, MenuItem, PredefinedMenuItem}, tray::{TrayIconBuilder, TrayIconEvent}};
```

**é€€å‡ºå‘½ä»¤ï¼š**
```rust
#[tauri::command]
fn quit_app(_app: tauri::AppHandle) -> Result<(), String> {
    info!("quit_app è¢«è°ƒç”¨ï¼Œå‡†å¤‡é€€å‡ºåº”ç”¨");
    std::process::exit(0);
}
```

**æ‰˜ç›˜èœå•åˆ›å»ºï¼š**
```rust
let show_main = MenuItem::with_id(app, "show_main", "æ˜¾ç¤ºä¸»çª—å£", true, None::<&str>)?;
let toggle_widget_menu = MenuItem::with_id(app, "toggle_widget", "æ˜¾ç¤º/éšè—å°ç»„ä»¶", true, None::<&str>)?;
let separator = PredefinedMenuItem::separator(app)?;
let quit = MenuItem::with_id(app, "quit", "é€€å‡º", true, None::<&str>)?;
```

#### 32.4 ä¿®å¤æ•ˆæœ
- âœ… **ç¼–è¯‘æˆåŠŸ**: æ‰€æœ‰ Rust ç¼–è¯‘é”™è¯¯å·²ä¿®å¤
- âœ… **æƒé™æ­£ç¡®**: ä½¿ç”¨äº†æ­£ç¡®çš„ Tauri v2 æƒé™é…ç½®
- âœ… **API å…¼å®¹**: ä½¿ç”¨äº†æ­£ç¡®çš„ Tauri v2 API
- âœ… **åŠŸèƒ½å®Œæ•´**: æ‰˜ç›˜èœå•å’Œé€€å‡ºåŠŸèƒ½æ­£å¸¸å·¥ä½œ

### 33. é‡å¤æ‰˜ç›˜å›¾æ ‡é—®é¢˜ä¿®å¤ (2025-06-16)

#### 33.1 é—®é¢˜å‘ç°
ç”¨æˆ·åé¦ˆå‡ºç°äº†ä¸¤ä¸ªæ‰˜ç›˜å›¾æ ‡ï¼š
- ä¸€ä¸ªå›¾æ ‡ç©ºç™½ï¼Œå¯ä»¥å”¤èµ·å³é”®èœå•
- ä¸€ä¸ªæœ‰ Tauri é»˜è®¤å›¾æ ‡ï¼Œä½†æ— æ³•æ“ä½œ

#### 33.2 é—®é¢˜åˆ†æ
é€šè¿‡ä»£ç æ£€æŸ¥å‘ç°ï¼Œæ‰˜ç›˜å›¾æ ‡è¢«åˆ›å»ºäº†ä¸¤æ¬¡ï¼š

**1. é…ç½®æ–‡ä»¶åˆ›å»º (`tauri.conf.json`)ï¼š**
```json
{
  "app": {
    "trayIcon": {
      "iconPath": "icons/icon.ico",
      "iconAsTemplate": true,
      "tooltip": "è¯¾ç¨‹è¡¨ç®¡ç†ç³»ç»Ÿ"
    }
  }
}
```

**2. ä»£ç ä¸­åˆ›å»º (`lib.rs`)ï¼š**
```rust
let _tray = TrayIconBuilder::with_id("main")
    .menu(&menu)
    .tooltip("è¯¾ç¨‹è¡¨ç®¡ç†ç³»ç»Ÿ")
    // ...
```

#### 33.3 ä¿®å¤æ–¹æ¡ˆ

**1. ç§»é™¤é…ç½®æ–‡ä»¶ä¸­çš„æ‰˜ç›˜é…ç½®ï¼š**
```json
{
  "app": {
    "security": {
      "csp": null
    }
    // ç§»é™¤ trayIcon é…ç½®
  }
}
```

**2. å®Œå–„ä»£ç ä¸­çš„æ‰˜ç›˜å®ç°ï¼š**
```rust
// æ·»åŠ å›¾æ ‡è®¾ç½®
let _tray = TrayIconBuilder::with_id("main")
    .icon(app.default_window_icon().unwrap().clone()) // ä½¿ç”¨åº”ç”¨é»˜è®¤å›¾æ ‡
    .menu(&menu)
    .tooltip("è¯¾ç¨‹è¡¨ç®¡ç†ç³»ç»Ÿ")
    // ...
```

#### 33.4 æŠ€æœ¯è¯´æ˜

**ä¸ºä»€ä¹ˆé€‰æ‹©ä»£ç å®ç°è€Œä¸æ˜¯é…ç½®æ–‡ä»¶ï¼Ÿ**
1. **çµæ´»æ€§** - ä»£ç å®ç°å¯ä»¥åŠ¨æ€å¤„ç†äº‹ä»¶å’ŒçŠ¶æ€
2. **åŠŸèƒ½å®Œæ•´** - å¯ä»¥æ·»åŠ èœå•ã€äº‹ä»¶å¤„ç†ç­‰å¤æ‚åŠŸèƒ½
3. **æ§åˆ¶ç²¾ç¡®** - å¯ä»¥ç²¾ç¡®æ§åˆ¶æ‰˜ç›˜å›¾æ ‡çš„è¡Œä¸º

**å›¾æ ‡æ¥æºï¼š**
- ä½¿ç”¨ `app.default_window_icon()` è·å–åº”ç”¨çš„é»˜è®¤çª—å£å›¾æ ‡
- ç¡®ä¿æ‰˜ç›˜å›¾æ ‡ä¸åº”ç”¨å›¾æ ‡ä¿æŒä¸€è‡´
- é¿å…äº†å›¾æ ‡è·¯å¾„é…ç½®é—®é¢˜

#### 33.5 ä¿®å¤æ•ˆæœ
- âœ… **å•ä¸€å›¾æ ‡**: ç°åœ¨åªæœ‰ä¸€ä¸ªæ‰˜ç›˜å›¾æ ‡
- âœ… **å›¾æ ‡æ­£ç¡®**: ä½¿ç”¨åº”ç”¨é»˜è®¤å›¾æ ‡ï¼Œæ˜¾ç¤ºæ­£å¸¸
- âœ… **åŠŸèƒ½å®Œæ•´**: å³é”®èœå•å’Œäº¤äº’åŠŸèƒ½æ­£å¸¸
- âœ… **ç”¨æˆ·ä½“éªŒ**: æ¶ˆé™¤äº†æ··ä¹±çš„åŒå›¾æ ‡é—®é¢˜

### 34. åç«¯æ•°æ®åº“è¿ç§»åˆ° SQLite + Diesel ORM (2025-06-16)

#### 34.1 è¿ç§»ç›®æ ‡
ç”¨æˆ·è¦æ±‚å°†åç«¯ä»å†…å­˜å­˜å‚¨æ”¹ä¸ºä½¿ç”¨ SQLite æ•°æ®åº“ï¼Œå¹¶ä½¿ç”¨ ORM æ¡†æ¶è¿›è¡Œæ•°æ®ç®¡ç†ã€‚

#### 34.2 æŠ€æœ¯é€‰å‹

**æ•°æ®åº“**: SQLite
- è½»é‡çº§ã€æ— æœåŠ¡å™¨
- é€‚åˆæ¡Œé¢åº”ç”¨
- æ”¯æŒ SQL æ ‡å‡†
- æ–‡ä»¶å­˜å‚¨ï¼Œæ˜“äºå¤‡ä»½

**ORM æ¡†æ¶**: Diesel
- Rust ç”Ÿæ€æœ€æˆç†Ÿçš„ ORM
- ç±»å‹å®‰å…¨çš„æŸ¥è¯¢æ„å»º
- è‡ªåŠ¨è¿ç§»ç®¡ç†
- ç¼–è¯‘æ—¶ SQL éªŒè¯

#### 34.3 å®ç°æ¶æ„

**1. ä¾èµ–é…ç½® (`Cargo.toml`):**
```toml
[dependencies]
diesel = { version = "2.1", features = ["sqlite", "chrono", "uuid"] }
diesel_migrations = "2.1"
libsqlite3-sys = { version = "0.27", features = ["bundled"] }
dotenvy = "0.15"
```

**2. æ•°æ®åº“é…ç½® (`.env`):**
```env
DATABASE_URL=sqlite:courses.db
RUST_LOG=debug
```

**3. é¡¹ç›®ç»“æ„:**
```
src/
â”œâ”€â”€ database.rs      # æ•°æ®åº“è¿æ¥å’Œè¿ç§»
â”œâ”€â”€ db_storage.rs    # Diesel ORM æ•°æ®è®¿é—®å±‚
â”œâ”€â”€ models.rs        # æ•°æ®æ¨¡å‹å®šä¹‰
â”œâ”€â”€ schema.rs        # æ•°æ®åº“è¡¨ç»“æ„
â”œâ”€â”€ handlers.rs      # API å¤„ç†å™¨
â””â”€â”€ main.rs          # åº”ç”¨å…¥å£

migrations/
â”œâ”€â”€ 00000000000000_diesel_initial_setup/
â””â”€â”€ 2025-06-16-000001_create_courses/
    â”œâ”€â”€ up.sql       # åˆ›å»ºè¡¨ç»“æ„
    â””â”€â”€ down.sql     # åˆ é™¤è¡¨ç»“æ„
```

#### 34.4 æ•°æ®æ¨¡å‹è®¾è®¡

**1. æ•°æ®åº“è¡¨ç»“æ„ (`up.sql`):**
```sql
CREATE TABLE courses (
    id TEXT PRIMARY KEY NOT NULL,
    name TEXT NOT NULL,
    teacher TEXT,
    location TEXT,
    weekday INTEGER NOT NULL CHECK (weekday >= 1 AND weekday <= 7),
    start_time TEXT NOT NULL,
    end_time TEXT NOT NULL,
    weeks TEXT NOT NULL, -- JSON æ•°ç»„å­˜å‚¨å‘¨æ¬¡ä¿¡æ¯
    color TEXT,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_courses_weekday ON courses(weekday);
CREATE INDEX idx_courses_start_time ON courses(start_time);

-- è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³è§¦å‘å™¨
CREATE TRIGGER update_courses_updated_at
    AFTER UPDATE ON courses
    FOR EACH ROW
    WHEN NEW.updated_at = OLD.updated_at
BEGIN
    UPDATE courses SET updated_at = CURRENT_TIMESTAMP WHERE id = NEW.id;
END;
```

**2. Rust æ•°æ®æ¨¡å‹:**
```rust
// æ•°æ®åº“æŸ¥è¯¢æ¨¡å‹
#[derive(Debug, Clone, Serialize, Deserialize, Queryable, Selectable)]
#[diesel(table_name = courses)]
pub struct Course {
    pub id: String,
    pub name: String,
    pub teacher: Option<String>,
    pub location: Option<String>,
    pub weekday: i32,
    pub start_time: String,
    pub end_time: String,
    pub weeks: String, // JSON å­—ç¬¦ä¸²
    pub color: Option<String>,
    pub created_at: NaiveDateTime,
    pub updated_at: NaiveDateTime,
}

// æ’å…¥æ¨¡å‹
#[derive(Debug, Insertable)]
#[diesel(table_name = courses)]
pub struct NewCourse { /* ... */ }

// æ›´æ–°æ¨¡å‹
#[derive(Debug, AsChangeset)]
#[diesel(table_name = courses)]
pub struct UpdateCourse { /* ... */ }

// API å“åº”æ¨¡å‹
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct CourseResponse {
    pub id: String,
    pub name: String,
    pub teacher: Option<String>,
    pub location: Option<String>,
    pub weekday: i32,
    pub start_time: String,
    pub end_time: String,
    pub weeks: Vec<i32>, // è§£æåçš„æ•°ç»„
    pub color: Option<String>,
}
```

#### 34.5 æ•°æ®è®¿é—®å±‚å®ç°

**1. æ•°æ®åº“è¿æ¥ç®¡ç†:**
```rust
pub fn establish_connection() -> SqliteConnection {
    let database_url = env::var("DATABASE_URL").expect("DATABASE_URL must be set");
    SqliteConnection::establish(&database_url)
        .unwrap_or_else(|e| panic!("Error connecting to {}: {}", database_url, e))
}

pub fn run_migrations(connection: &mut SqliteConnection) {
    connection
        .run_pending_migrations(MIGRATIONS)
        .expect("Failed to run migrations");
}
```

**2. CRUD æ“ä½œ:**
```rust
// æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹
pub fn get_all_courses() -> Result<Vec<CourseResponse>, diesel::result::Error> {
    let mut connection = establish_connection();
    let results = courses::table
        .select(Course::as_select())
        .load(&mut connection)?;
    Ok(results.into_iter().map(|course| course.into()).collect())
}

// åˆ›å»ºè¯¾ç¨‹
pub fn insert_course(course_req: &CreateCourseRequest) -> Result<CourseResponse, diesel::result::Error> {
    let mut connection = establish_connection();
    let course_id = Uuid::new_v4().to_string();
    let weeks_json = serde_json::to_string(&course_req.weeks).unwrap_or_default();

    let new_course = NewCourse { /* ... */ };
    diesel::insert_into(courses::table)
        .values(&new_course)
        .execute(&mut connection)?;

    // è¿”å›æ’å…¥çš„è¯¾ç¨‹
    let inserted_course = courses::table
        .filter(courses::id.eq(&course_id))
        .select(Course::as_select())
        .first(&mut connection)?;

    Ok(inserted_course.into())
}

// æ›´æ–°è¯¾ç¨‹
pub fn update_course(course_id: &str, update_req: &UpdateCourseRequest) -> Result<Option<CourseResponse>, diesel::result::Error> { /* ... */ }

// åˆ é™¤è¯¾ç¨‹
pub fn delete_course(course_id: &str) -> Result<bool, diesel::result::Error> { /* ... */ }

// æ‰¹é‡æ“ä½œ
pub fn insert_multiple_courses(course_requests: &[CreateCourseRequest]) -> Result<Vec<CourseResponse>, diesel::result::Error> { /* ... */ }
```

#### 34.6 API å±‚æ›´æ–°

**é‡æ„ handlers.rs:**
```rust
#[get("/schedule")]
pub async fn get_schedule() -> Result<HttpResponse> {
    match crate::db_storage::get_all_courses() {
        Ok(courses) => {
            let schedule = Schedule { courses };
            Ok(HttpResponse::Ok().json(schedule))
        }
        Err(e) => {
            error!("âŒ è·å–è¯¾ç¨‹è¡¨å¤±è´¥: {}", e);
            Ok(HttpResponse::InternalServerError().json("Failed to get schedule"))
        }
    }
}

#[post("/courses")]
pub async fn create_course(course_req: web::Json<CreateCourseRequest>) -> Result<HttpResponse> {
    match crate::db_storage::insert_course(&course_req) {
        Ok(created_course) => Ok(HttpResponse::Created().json(created_course)),
        Err(e) => {
            error!("âŒ è¯¾ç¨‹åˆ›å»ºå¤±è´¥: {}", e);
            Ok(HttpResponse::InternalServerError().json("Failed to create course"))
        }
    }
}
```

#### 34.7 è¿ç§»è¿‡ç¨‹

**1. ä¾èµ–å®‰è£…:**
- æ·»åŠ  Diesel ç›¸å…³ä¾èµ–
- é…ç½® SQLite ç‰¹æ€§
- æ·»åŠ ç¯å¢ƒå˜é‡æ”¯æŒ

**2. æ•°æ®åº“è®¾è®¡:**
- åˆ›å»ºè¿ç§»æ–‡ä»¶
- è®¾è®¡è¡¨ç»“æ„å’Œç´¢å¼•
- æ·»åŠ è§¦å‘å™¨è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³

**3. æ¨¡å‹é‡æ„:**
- å®šä¹‰ Diesel å…¼å®¹çš„æ•°æ®æ¨¡å‹
- åˆ†ç¦»æ•°æ®åº“æ¨¡å‹å’Œ API æ¨¡å‹
- å®ç°æ¨¡å‹è½¬æ¢é€»è¾‘

**4. æ•°æ®è®¿é—®å±‚:**
- å®ç°å®Œæ•´çš„ CRUD æ“ä½œ
- æ·»åŠ äº‹åŠ¡æ”¯æŒ
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

**5. API å±‚é€‚é…:**
- æ›´æ–°æ‰€æœ‰ handler å‡½æ•°
- ç»Ÿä¸€é”™è¯¯å¤„ç†
- ä¿æŒ API æ¥å£å…¼å®¹æ€§

#### 34.8 æµ‹è¯•éªŒè¯

**API æµ‹è¯•ç»“æœ:**

âœ… **GET /api/v1/schedule**
- çŠ¶æ€ç : 200 OK
- å“åº”: `{"courses":[]}`
- éªŒè¯: æ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢æ­£å¸¸

âœ… **POST /api/v1/courses**
- çŠ¶æ€ç : 201 Created
- å“åº”: å®Œæ•´è¯¾ç¨‹ä¿¡æ¯ + UUID
- éªŒè¯: æ•°æ®æ’å…¥å’Œåºåˆ—åŒ–æ­£å¸¸

âœ… **PUT /api/v1/courses/{id}**
- çŠ¶æ€ç : 200 OK
- å“åº”: æ›´æ–°åçš„è¯¾ç¨‹ä¿¡æ¯
- éªŒè¯: æ•°æ®æ›´æ–°å’Œéƒ¨åˆ†å­—æ®µæ›´æ–°æ­£å¸¸

âœ… **DELETE /api/v1/courses/{id}**
- çŠ¶æ€ç : 200 OK
- å“åº”: `"Course deleted successfully"`
- éªŒè¯: æ•°æ®åˆ é™¤æ­£å¸¸

âœ… **æ•°æ®æŒä¹…åŒ–éªŒè¯**
- åˆ›å»º â†’ æŸ¥è¯¢ â†’ æ›´æ–° â†’ æŸ¥è¯¢ â†’ åˆ é™¤ â†’ æŸ¥è¯¢
- æ‰€æœ‰æ“ä½œæ•°æ®ä¸€è‡´æ€§æ­£ç¡®

#### 34.9 æŠ€æœ¯ä¼˜åŠ¿

**1. ç±»å‹å®‰å…¨:**
- ç¼–è¯‘æ—¶ SQL éªŒè¯
- å¼ºç±»å‹æŸ¥è¯¢æ„å»º
- é˜²æ­¢ SQL æ³¨å…¥

**2. æ€§èƒ½ä¼˜åŒ–:**
- è¿æ¥æ± ç®¡ç†
- ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
- æ‰¹é‡æ“ä½œæ”¯æŒ

**3. æ•°æ®å®Œæ•´æ€§:**
- å¤–é”®çº¦æŸ
- æ£€æŸ¥çº¦æŸ
- äº‹åŠ¡æ”¯æŒ

**4. å¼€å‘ä½“éªŒ:**
- è‡ªåŠ¨è¿ç§»ç®¡ç†
- æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- ä¸°å¯Œçš„æŸ¥è¯¢ API

**5. ç”Ÿäº§å°±ç»ª:**
- å®Œæ•´çš„é”™è¯¯å¤„ç†
- ç»“æ„åŒ–æ—¥å¿—
- é…ç½®ç®¡ç†

#### 34.10 å®ç°æ•ˆæœ

- âœ… **æ•°æ®åº“è¿ç§»**: æˆåŠŸä»å†…å­˜å­˜å‚¨è¿ç§»åˆ° SQLite
- âœ… **ORM é›†æˆ**: Diesel ORM å®Œå…¨é›†æˆå¹¶æ­£å¸¸å·¥ä½œ
- âœ… **API å…¼å®¹**: æ‰€æœ‰ç°æœ‰ API æ¥å£ä¿æŒå…¼å®¹
- âœ… **æ•°æ®æŒä¹…åŒ–**: æ•°æ®åœ¨åº”ç”¨é‡å¯åä¿æŒ
- âœ… **ç±»å‹å®‰å…¨**: ç¼–è¯‘æ—¶éªŒè¯æ‰€æœ‰æ•°æ®åº“æ“ä½œ
- âœ… **æ€§èƒ½ä¼˜åŒ–**: ç´¢å¼•å’ŒæŸ¥è¯¢ä¼˜åŒ–
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… **æµ‹è¯•éªŒè¯**: æ‰€æœ‰ CRUD æ“ä½œæµ‹è¯•é€šè¿‡

### 35. ç¤ºä¾‹è¯¾ç¨‹æ•°æ®æ’å…¥ (2025-06-16)

#### 35.1 æ•°æ®æ¥æº
ç”¨æˆ·æä¾›äº†ç¬¬20å‘¨å‘¨ä¸€çš„å®Œæ•´è¯¾ç¨‹è¡¨ï¼š

```
7:15-7:55   è‹±è¯­
8:00-8:40   ç”Ÿç‰©
8:50-9:30   æ”¿æ²»
9:45-10:25  åŒ–å­¦
10:35-11:15 ç‰©ç†
11:20-12:00 ç‰©ç†
13:00-13:40 æ•°å­¦
13:50-14:30 åœ°ç†
15:00-15:40 å†å²
```

#### 35.2 æ•°æ®è®¾è®¡

**è¯¾ç¨‹ä¿¡æ¯è¡¥å……:**
- **æ•™å¸ˆ**: ä¸ºæ¯é—¨è¯¾ç¨‹åˆ†é…äº†åˆé€‚çš„æ•™å¸ˆå§“å
- **æ•™å®¤**: æ ¹æ®è¯¾ç¨‹æ€§è´¨åˆ†é…æ•™å­¦æ¥¼å’Œå®éªŒæ¥¼
- **é¢œè‰²**: ä¸ºæ¯é—¨è¯¾ç¨‹åˆ†é…äº†ä¸åŒçš„ä¸»é¢˜è‰²å½©
- **å‘¨æ¬¡**: è®¾ç½®ä¸ºç¬¬20å‘¨
- **æ˜ŸæœŸ**: å‘¨ä¸€ (weekday=1)

**å…·ä½“æ•°æ®:**
```json
{
  "courses": [
    {
      "name": "è‹±è¯­",
      "teacher": "ç‹è€å¸ˆ",
      "location": "æ•™å­¦æ¥¼A301",
      "weekday": 1,
      "start_time": "07:15:00",
      "end_time": "07:55:00",
      "weeks": [20],
      "color": "#2196F3"
    },
    {
      "name": "ç”Ÿç‰©",
      "teacher": "å¼ è€å¸ˆ",
      "location": "å®éªŒæ¥¼B201",
      "weekday": 1,
      "start_time": "08:00:00",
      "end_time": "08:40:00",
      "weeks": [20],
      "color": "#4CAF50"
    },
    // ... å…¶ä»–7é—¨è¯¾ç¨‹
  ],
  "replace": false
}
```

#### 35.3 æ‰¹é‡æ’å…¥æ“ä½œ

**ä½¿ç”¨ API**: `POST /api/v1/schedule/push`
- **æ–¹æ³•**: æ‰¹é‡æ¨é€è¯¾ç¨‹è¡¨
- **æ¨¡å¼**: è¿½åŠ æ¨¡å¼ (`replace: false`)
- **ç»“æœ**: æˆåŠŸæ’å…¥ 9 é—¨è¯¾ç¨‹

**æ“ä½œå‘½ä»¤:**
```powershell
Invoke-WebRequest -Uri 'http://localhost:8080/api/v1/schedule/push'
  -Method POST -InFile 'monday_schedule.json' -ContentType 'application/json'
```

**å“åº”ç»“æœ:**
- âœ… çŠ¶æ€ç : 200 OK
- âœ… å“åº”å¤§å°: 1813 å­—èŠ‚
- âœ… åŒ…å«æ‰€æœ‰è¯¾ç¨‹çš„å®Œæ•´ä¿¡æ¯å’Œç”Ÿæˆçš„ UUID

#### 35.4 æ•°æ®éªŒè¯

**éªŒè¯æŸ¥è¯¢**: `GET /api/v1/schedule`
- âœ… è¿”å› 9 é—¨è¯¾ç¨‹
- âœ… æ—¶é—´å®‰æ’æ­£ç¡®
- âœ… è¯¾ç¨‹ä¿¡æ¯å®Œæ•´
- âœ… æ•°æ®æŒä¹…åŒ–æˆåŠŸ

**è¯¾ç¨‹æ—¶é—´è¡¨éªŒè¯:**
```
07:15-07:55  è‹±è¯­ (ç‹è€å¸ˆ, æ•™å­¦æ¥¼A301)
08:00-08:40  ç”Ÿç‰© (å¼ è€å¸ˆ, å®éªŒæ¥¼B201)
08:50-09:30  æ”¿æ²» (æè€å¸ˆ, æ•™å­¦æ¥¼A205)
09:45-10:25  åŒ–å­¦ (èµµè€å¸ˆ, å®éªŒæ¥¼C101)
10:35-11:15  ç‰©ç† (é™ˆè€å¸ˆ, å®éªŒæ¥¼C203)
11:20-12:00  ç‰©ç† (é™ˆè€å¸ˆ, å®éªŒæ¥¼C203)
13:00-13:40  æ•°å­¦ (åˆ˜è€å¸ˆ, æ•™å­¦æ¥¼A102)
13:50-14:30  åœ°ç† (å­™è€å¸ˆ, æ•™å­¦æ¥¼B305)
15:00-15:40  å†å² (å‘¨è€å¸ˆ, æ•™å­¦æ¥¼A403)
```

#### 35.5 è®¾è®¡ç‰¹ç‚¹

**1. æ•™å®¤åˆ†é…é€»è¾‘:**
- ç†ç§‘å®éªŒè¯¾ç¨‹ â†’ å®éªŒæ¥¼ (ç”Ÿç‰©ã€åŒ–å­¦ã€ç‰©ç†)
- æ–‡ç§‘ç†è®ºè¯¾ç¨‹ â†’ æ•™å­¦æ¥¼ (è‹±è¯­ã€æ”¿æ²»ã€æ•°å­¦ã€åœ°ç†ã€å†å²)

**2. é¢œè‰²ä¸»é¢˜:**
- è‹±è¯­: è“è‰² (#2196F3)
- ç”Ÿç‰©: ç»¿è‰² (#4CAF50)
- æ”¿æ²»: æ©™è‰² (#FF9800)
- åŒ–å­¦: ç´«è‰² (#9C27B0)
- ç‰©ç†: çº¢è‰² (#FF5722)
- æ•°å­¦: é›è“ (#3F51B5)
- åœ°ç†: æ£•è‰² (#795548)
- å†å²: è“ç° (#607D8B)

**3. æ•™å¸ˆå‘½å:**
- ä½¿ç”¨å¸¸è§ä¸­æ–‡å§“æ°
- æ¯é—¨è¯¾ç¨‹åˆ†é…ä¸“é—¨æ•™å¸ˆ
- ç‰©ç†è¯¾ç¨‹ä½¿ç”¨åŒä¸€æ•™å¸ˆ (è¿å ‚è¯¾)

#### 35.6 å®ç°æ•ˆæœ

- âœ… **æ•°æ®å®Œæ•´æ€§**: æ‰€æœ‰å¿…å¡«å­—æ®µéƒ½æœ‰åˆç†å€¼
- âœ… **æ—¶é—´å‡†ç¡®æ€§**: ä¸¥æ ¼æŒ‰ç…§ç”¨æˆ·æä¾›çš„æ—¶é—´å®‰æ’
- âœ… **æ‰¹é‡æ“ä½œ**: ä¸€æ¬¡æ€§æ’å…¥æ‰€æœ‰è¯¾ç¨‹
- âœ… **æ•°æ®æŒä¹…åŒ–**: æ•°æ®æˆåŠŸä¿å­˜åˆ° SQLite æ•°æ®åº“
- âœ… **API å…¼å®¹æ€§**: ä½¿ç”¨æ ‡å‡†çš„æ‰¹é‡æ¨é€æ¥å£
- âœ… **å‰ç«¯å°±ç»ª**: æ•°æ®æ ¼å¼å®Œå…¨å…¼å®¹å‰ç«¯æ˜¾ç¤ºéœ€æ±‚

### 26. æ¡Œé¢å°ç»„ä»¶å­—ä½“å¤§å°ä¼˜åŒ–

#### 26.1 ç”¨æˆ·éœ€æ±‚
ç”¨æˆ·åé¦ˆæ¡Œé¢å°ç»„ä»¶ä¸­çš„æ—¶é—´å’Œè¯¾ç¨‹åå­—å­—ä½“åå°ï¼Œéœ€è¦å¢å¤§ä»¥æé«˜å¯è¯»æ€§ã€‚

#### 26.2 ä¿®æ”¹å†…å®¹
åœ¨ `DesktopScheduleWidget.vue` ä¸­è°ƒæ•´äº†ä»¥ä¸‹å­—ä½“å¤§å°ï¼š

**æ—¶é—´æ˜¾ç¤ºä¼˜åŒ–ï¼š**
- å½“å‰æ—¶é—´ï¼šä» `0.85rem` å¢åŠ åˆ° `1.1rem`
- å¼€å§‹æ—¶é—´ï¼šä» `0.9rem` å¢åŠ åˆ° `1.1rem`
- ç»“æŸæ—¶é—´ï¼šä» `0.75rem` å¢åŠ åˆ° `0.9rem`

**è¯¾ç¨‹ä¿¡æ¯ä¼˜åŒ–ï¼š**
- è¯¾ç¨‹åå­—ï¼šä» `0.9rem` å¢åŠ åˆ° `1.1rem`

#### 26.3 æ•ˆæœ
- âœ… æ—¶é—´ä¿¡æ¯æ›´åŠ æ¸…æ™°æ˜“è¯»
- âœ… è¯¾ç¨‹åå­—æ›´åŠ çªå‡º
- âœ… ä¿æŒäº†æ•´ä½“å¸ƒå±€çš„åè°ƒæ€§
- âœ… æå‡äº†æ¡Œé¢å°ç»„ä»¶çš„ç”¨æˆ·ä½“éªŒ

### 27. Git ä»“åº“åˆå§‹åŒ–å’Œé¦–æ¬¡æäº¤

#### 27.1 ä»“åº“åˆå§‹åŒ–
å®Œæˆäº†æ•´ä¸ªé¡¹ç›®çš„ Git ç‰ˆæœ¬æ§åˆ¶åˆå§‹åŒ–ï¼š
- è§£å†³äº† Git å®‰å…¨ç›®å½•æƒé™é—®é¢˜
- æ·»åŠ äº†æ‰€æœ‰é¡¹ç›®æ–‡ä»¶åˆ°ç‰ˆæœ¬æ§åˆ¶

#### 27.2 é¦–æ¬¡æäº¤
ç”Ÿæˆäº†è¯¦ç»†çš„ commit message å¹¶å®Œæˆé¦–æ¬¡æäº¤ï¼š

**Commit Hash**: `0369a6a`
**Commit Message**: `feat: åˆå§‹åŒ–è¯¾ç¨‹è¡¨ç®¡ç†ç³»ç»Ÿ`

**æäº¤å†…å®¹**:
- ğŸ¦€ **Ruståç«¯**: Actix-web + Diesel + SQLite
- ğŸ¨ **Vue3å‰ç«¯**: Tauri + Element Plus
- ğŸªŸ **æ¡Œé¢åº”ç”¨**: åŒçª—å£æ¶æ„ + ç³»ç»Ÿæ‰˜ç›˜
- ğŸ“± **æ ¸å¿ƒåŠŸèƒ½**: è¯¾ç¨‹ç®¡ç† + å®æ—¶çŠ¶æ€ + æ¡Œé¢å°ç»„ä»¶

**ç»Ÿè®¡æ•°æ®**:
- 77 ä¸ªæ–‡ä»¶
- 17,128 è¡Œä»£ç 
- å®Œæ•´çš„å‰åç«¯åˆ†ç¦»æ¶æ„
